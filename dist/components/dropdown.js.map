{"version":3,"file":"dropdown.js","sources":["../../src/components/dropdown.gts"],"sourcesContent":["import { fn, hash } from '@ember/helper';\nimport { on } from '@ember/modifier';\nimport { service } from '@ember/service';\nimport Component from '@glimmer/component';\n\nimport Popover from './popover.gts';\nimport { classes } from '../helpers/classes.ts';\nimport onClickOutside from '../modifiers/on-click-outside.ts';\nimport onInsert from '../modifiers/on-insert.ts';\n\nimport type { Direction, PopoverVisibility } from './popover.gts';\nimport type { TOC } from '@ember/component/template-only';\nimport type { Alignment } from '@floating-ui/dom';\nimport type { ComponentLike, WithBoundArgs } from '@glint/template';\nimport type IntlService from 'ember-intl/services/intl';\n\ninterface ItemSignature {\n  Element: HTMLSpanElement;\n  Args: {\n    closeOnSelect?: boolean;\n    disabled?: boolean;\n\n    onSelect?: (evt: MouseEvent) => unknown;\n    onSelectInternal: (\n      evt: MouseEvent,\n      shouldClose: boolean,\n      callback?: (evt: MouseEvent) => unknown,\n    ) => unknown;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\nclass Item extends Component<ItemSignature> {\n  onSelect = (evt: MouseEvent) => {\n    if (this.args.disabled) {\n      return;\n    }\n\n    this.args.onSelectInternal(evt, this.args.closeOnSelect ?? true, this.args.onSelect);\n  };\n\n  <template>\n    <li aria-selected=\"false\" role=\"option\" data-test-dropdown-item {{on \"click\" this.onSelect}}>\n      <span class={{classes \"dropdown-item\" (if @disabled \"disabled\")}} ...attributes>\n        {{yield}}\n      </span>\n    </li>\n  </template>\n}\n\ninterface DividerSignature {\n  Element: HTMLHRElement;\n}\n\nconst Divider: TOC<DividerSignature> = <template>\n  <li>\n    <hr class=\"dropdown-divider\" data-test-dropdown-divider ...attributes />\n  </li>\n</template>;\n\ninterface HeaderSignature {\n  Element: HTMLHeadingElement;\n  Blocks: {\n    default: [];\n  };\n}\n\nconst Header: TOC<HeaderSignature> = <template>\n  <li>\n    <h5 class=\"dropdown-header\" data-test-dropdown-header ...attributes>\n      {{yield}}\n    </h5>\n  </li>\n</template>;\n\nexport interface DropdownSignature {\n  Element: HTMLDivElement;\n  Args: {\n    alignment?: Alignment;\n    closeOnSelect?: boolean;\n    controlElement?: HTMLElement;\n    disabled?: boolean;\n    flip?: boolean;\n    fullWidth?: boolean;\n    hasIcon?: boolean;\n    icon?: string;\n    iconOnly?: boolean;\n    loading?: boolean;\n    offset?: string | number;\n    scrollable?: boolean;\n    side?: Direction;\n\n    onShow?: () => unknown | Promise<unknown>;\n    onHide?: () => unknown | Promise<unknown>;\n  };\n  Blocks: {\n    control: [PopoverVisibility];\n    menu: [\n      {\n        Divider: ComponentLike<DividerSignature>;\n        Header: ComponentLike<HeaderSignature>;\n        Item: WithBoundArgs<typeof Item, 'onSelectInternal'>;\n      },\n    ];\n  };\n}\n\nexport default class Dropdown extends Component<DropdownSignature> {\n  declare menuElement: HTMLElement;\n  declare visibility: PopoverVisibility;\n\n  menuId = crypto.randomUUID();\n\n  @service\n  declare intl: IntlService;\n\n  get alignment(): Alignment {\n    return this.args.alignment ?? 'start';\n  }\n\n  get disabled() {\n    return this.args.disabled || this.args.loading;\n  }\n\n  get hasIcon() {\n    return this.args.hasIcon ?? true;\n  }\n\n  get showLeftIcon() {\n    return this.hasIcon && this.args.side === 'start';\n  }\n\n  get showRightIcon() {\n    return this.hasIcon && !this.showLeftIcon;\n  }\n\n  get icon() {\n    if (this.args.icon) {\n      return this.args.icon;\n    }\n\n    switch (this.args.side) {\n      case 'top':\n        return 'bi-caret-up-fill';\n      case 'start':\n        return 'bi-caret-left-fill';\n      case 'end':\n        return 'bi-caret-right-fill';\n      case 'bottom':\n      default:\n        return 'bi-caret-down-fill';\n    }\n  }\n\n  get scrollable() {\n    return this.args.scrollable ?? true;\n  }\n\n  onMenuInsert = (visibility: PopoverVisibility, element: HTMLElement) => {\n    this.visibility = visibility;\n    this.menuElement = element;\n  };\n\n  onSelect = async (\n    evt: MouseEvent,\n    shouldClose: boolean,\n    callback?: (evt: MouseEvent) => unknown,\n  ) => {\n    if (!this.visibility.isShown) {\n      return;\n    }\n\n    if (shouldClose) {\n      await this.visibility.hide();\n    }\n\n    await callback?.(evt);\n  };\n\n  <template>\n    <div class=\"dropdown\" {{onClickOutside this.visibility.hide}} ...attributes>\n      <Popover\n        class=\"border-0\"\n        @alignment={{this.alignment}}\n        @arrow={{false}}\n        @flip={{@flip}}\n        @fullWidth={{@fullWidth}}\n        @offset={{@offset}}\n        @side={{@side}}\n        @onShow={{@onShow}}\n        @onHide={{@onHide}}\n      >\n        <:control as |visibility|>\n          {{#if (has-block-params \"control\")}}\n            {{yield visibility to=\"control\"}}\n          {{else}}\n            <button\n              aria-controls={{this.menuId}}\n              aria-disabled={{if this.disabled \"true\"}}\n              {{! This is intentional - if isShown is false, the attribute is removed }}\n              aria-expanded=\"{{visibility.isShown}}\"\n              aria-haspopup=\"listbox\"\n              class=\"btn dropdown text-start\"\n              disabled={{this.disabled}}\n              role=\"combobox\"\n              type=\"button\"\n              {{on \"click\" visibility.toggle}}\n            >\n              {{#if this.showLeftIcon}}\n                <i\n                  class={{classes \"icon\" this.icon (unless @iconOnly \"float-start ms-n1 me-1\")}}\n                ></i>\n              {{/if}}\n              {{yield visibility to=\"control\"}}\n              {{#if this.showRightIcon}}\n                <i class={{classes \"icon\" this.icon (unless @iconOnly \"float-end ms-1 me-n1\")}}></i>\n              {{/if}}\n            </button>\n          {{/if}}\n        </:control>\n        <:content as |Content visibility|>\n          <Content.Body class=\"p-0\">\n            <ul\n              class={{classes\n                \"dropdown-menu\"\n                (unless visibility.isShown \"hidden\")\n                (if this.scrollable \"scrollable\")\n              }}\n              id={{this.menuId}}\n              role=\"listbox\"\n              {{onInsert (fn this.onMenuInsert visibility)}}\n            >\n              {{yield\n                (hash\n                  Divider=(component Divider)\n                  Header=(component Header)\n                  Item=(component Item closeOnSelect=@closeOnSelect onSelectInternal=this.onSelect)\n                )\n                to=\"menu\"\n              }}\n            </ul>\n          </Content.Body>\n        </:content>\n      </Popover>\n    </div>\n  </template>\n}\n"],"names":["Item","Component","onSelect","evt","args","disabled","onSelectInternal","closeOnSelect","setComponentTemplate","precompileTemplate","strictMode","scope","on","classes","Divider","templateOnly","Header","Dropdown","menuId","crypto","randomUUID","g","prototype","service","i","alignment","loading","hasIcon","showLeftIcon","side","showRightIcon","icon","scrollable","onMenuInsert","visibility","element","menuElement","shouldClose","callback","isShown","hide","onClickOutside","Popover","onInsert","fn","hash"],"mappings":"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"}