{"version":3,"file":"context-menu.js","sources":["../../src/components/context-menu.gts"],"sourcesContent":["import { assert, warn } from '@ember/debug';\nimport { on } from '@ember/modifier';\nimport { service } from '@ember/service';\nimport Component from '@glimmer/component';\nimport { t } from 'ember-intl';\n\nimport Dropdown from './dropdown.gts';\nimport onDestroy from '../modifiers/on-destroy.ts';\nimport onInsert from '../modifiers/on-insert.ts';\n\nimport type { Direction } from './popover.ts';\nimport type { Dropdown as DropdownType } from '../services/context-menu.ts';\nimport type ContextMenuService from '../services/context-menu.ts';\nimport type { Alignment } from '@floating-ui/dom';\n\nexport interface ContextMenuItemSignature {\n  Element: HTMLHRElement | HTMLHeadingElement | HTMLSpanElement;\n  Args: {\n    bottom?: boolean;\n    closeOnSelect?: boolean;\n    disabled?: boolean;\n    divider?: boolean;\n    header?: boolean;\n    menuId: string;\n\n    onSelect?: (evt: MouseEvent) => unknown;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\nexport class ContextMenuItem extends Component<ContextMenuItemSignature> {\n  @service\n  declare contextMenu: ContextMenuService;\n\n  get menu() {\n    const { menuId } = this.args;\n    const menu = this.contextMenu.menu(menuId);\n\n    warn(\n      `[ContextMenuItem] Context menu with id \"${menuId}\" not found. Make sure the context menu exists before trying to access it.` +\n        ' This warning may be thrown if the context menu was registered in the same render cycle as the access.' +\n        ' If this is the case, you can ignore this warning.',\n      Boolean(menu),\n      {\n        id: 'nrg-ui.context-menu.not-found',\n      },\n    );\n\n    return menu;\n  }\n\n  get renderTo() {\n    return this.args.bottom ? this.menu?.bottom : this.menu?.top;\n  }\n\n  get options(): DropdownType | undefined {\n    return this.menu?.dropdown;\n  }\n\n  <template>\n    {{#if this.renderTo}}\n      {{#in-element this.renderTo insertBefore=null}}\n        {{#let this.options as |Options|}}\n          {{#if @divider}}\n            <Options.Divider ...attributes />\n          {{else if @header}}\n            <Options.Header ...attributes>\n              {{yield}}\n            </Options.Header>\n          {{else}}\n            <Options.Item\n              @closeOnSelect={{@closeOnSelect}}\n              @disabled={{@disabled}}\n              @onSelect={{@onSelect}}\n              ...attributes\n            >\n              {{yield}}\n            </Options.Item>\n          {{/if}}\n        {{/let}}\n      {{/in-element}}\n    {{/if}}\n  </template>\n}\n\nexport interface ContextMenuSignature {\n  Element: HTMLDivElement;\n  Args: {\n    disabled?: boolean;\n    id: string;\n\n    // Inherited from Dropdown\n    alignment?: Alignment;\n    closeOnSelect?: boolean;\n    controlElement?: HTMLElement;\n    flip?: boolean;\n    fullWidth?: boolean;\n    hasIcon?: boolean;\n    loading?: boolean;\n    offset?: string | number;\n    scrollable?: boolean;\n    side?: Direction;\n\n    onShow?: () => unknown | Promise<unknown>;\n    onHide?: () => unknown | Promise<unknown>;\n  };\n  Blocks: {\n    default: [DropdownType];\n  };\n}\n\nexport default class ContextMenu extends Component<ContextMenuSignature> {\n  @service\n  declare contextMenu: ContextMenuService;\n\n  register = (top: HTMLDivElement, { menu: dropdown }: { menu: DropdownType }) => {\n    const { id } = this.args;\n\n    assert('ContextMenu requires an id', id);\n\n    const bottom = top.nextElementSibling as HTMLDivElement;\n\n    this.contextMenu.register(id, { top, bottom, dropdown });\n  };\n\n  unregister = () => {\n    this.contextMenu.unregister(this.args.id);\n  };\n\n  <template>\n    <Dropdown\n      class=\"context-menu\"\n      @alignment={{@alignment}}\n      @disabled={{@disabled}}\n      @closeOnSelect={{@closeOnSelect}}\n      @controlElement={{@controlElement}}\n      @flip={{@flip}}\n      @fullWidth={{@fullWidth}}\n      @hasIcon={{@hasIcon}}\n      @loading={{@loading}}\n      @offset={{@offset}}\n      @scrollable={{@scrollable}}\n      @side={{@side}}\n      @onHide={{@onHide}}\n      @onShow={{@onShow}}\n      ...attributes\n    >\n      <:control as |visibility|>\n        <i\n          aria-disabled={{if @disabled \"true\"}}\n          class=\"bi bi-three-dots-vertical p-1\"\n          role=\"button\"\n          title={{t \"nrg.navbar.toggleContextMenu\"}}\n          {{on \"click\" visibility.toggle}}\n        />\n      </:control>\n      <:menu as |Menu|>\n        <div\n          class=\"dropdown-top\"\n          {{onInsert this.register menu=Menu}}\n          {{onDestroy this.unregister}}\n        >\n          {{yield Menu}}\n        </div>\n        <div class=\"dropdown-bottom\"></div>\n      </:menu>\n    </Dropdown>\n  </template>\n}\n"],"names":["ContextMenuItem","Component","g","prototype","service","i","menu","menuId","args","contextMenu","warn","Boolean","id","renderTo","bottom","top","options","dropdown","setComponentTemplate","precompileTemplate","strictMode","ContextMenu","register","assert","nextElementSibling","unregister","scope","Dropdown","t","on","onInsert","onDestroy"],"mappings":";;;;;;;;;;;;AAgCO,MAAMA,wBAAwBC,SAAA,CAAU;AAAA,EAAA;IAAAC,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,aAAA,EAAA,CAC5CC,OAAA,CAAA,CAAA;AAAA;EAAA,YAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,aAAA,CAAA,EAAA,MAAA;EAGD,IAAIC,IAAAA,GAAO;IACT,MAAM;AAAEC,MAAAA;KAAQ,GAAG,IAAI,CAACC,IAAI;IAC5B,MAAMF,OAAO,IAAI,CAACG,WAAW,CAACH,IAAI,CAACC,MAAA,CAAA;AAEnCG,IAAAA,IAAA,CACE,CAAA,wCAAA,EAA2CH,MAAA,CAAA,0EAAA,CAAkF,GAC3H,wGAAA,GACA,oDAAA,EACFI,OAAA,CAAQL,IAAA,CAAA,EACR;AACEM,MAAAA,EAAA,EAAI;AACN,KAAA,CAAA;AAGF,IAAA,OAAON,IAAA;AACT,EAAA;EAEA,IAAIO,QAAAA,GAAW;AACb,IAAA,OAAO,IAAI,CAACL,IAAI,CAACM,MAAM,GAAG,IAAI,CAACR,IAAI,EAAEQ,MAAA,GAAS,IAAI,CAACR,IAAI,EAAES,GAAA;AAC3D,EAAA;EAEA,IAAIC,OAAAA,GAAoC;AACtC,IAAA,OAAO,IAAI,CAACV,IAAI,EAAEW,QAAA;AACpB,EAAA;AAEA,EAAA;IAAAC,oBAAA,CAAAC,kBAAA,CAAA,uhBAAA,EAuBA;MAAAC,UAAA,EAAA;KAAU,CAAA,EAAV,IAAW,CAAA;AAAD;AACZ;AA4Be,MAAMC,oBAAoBpB,SAAA,CAAU;AAAA,EAAA;IAAAC,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,aAAA,EAAA,CAChDC,OAAA,CAAA,CAAA;AAAA;EAAA,YAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,aAAA,CAAA,EAAA,MAAA;EAGDiB,QAAA,GAAWA,CAACP,GAAK,EAAgB;AAAET,IAAAA,MAAMW;AAAkC,GAAA,KAAA;IACzE,MAAM;AAAEL,MAAAA;KAAI,GAAG,IAAI,CAACJ,IAAI;AAExBe,IAAAA,MAAA,CAAO,4BAAA,EAA8BX,EAAA,CAAA;AAErC,IAAA,MAAME,MAAA,GAASC,GAAA,CAAIS,kBAAsB;AAEzC,IAAA,IAAI,CAACf,WAAW,CAACa,QAAQ,CAACV,EAAA,EAAI;MAAEG,GAAA;MAAKD,MAAA;AAAQG,MAAAA;AAAS,KAAA,CAAA;EACxD,CAAA;EAEAQ,UAAA,GAAaA,MAAA;IACX,IAAI,CAAChB,WAAW,CAACgB,UAAU,CAAC,IAAI,CAACjB,IAAI,CAACI,EAAE,CAAA;EAC1C,CAAA;AAEA,EAAA;IAAAM,oBAAA,CAAAC,kBAAA,CAAA,+yBAAA,EAsCA;MAAAC,UAAA,EAAA,IAAA;AAAAM,MAAAA,KAAA,EAAAA,OAAA;QAAAC,QAAA;QAAAC,CAAA;QAAAC,EAAA;kBAAAC,gBAAA;AAAAC,mBAAAA;AAAA,OAAA;KAAU,CAAA,EAAV,IAAW,CAAA;AAAD;AACZ;;;;"}