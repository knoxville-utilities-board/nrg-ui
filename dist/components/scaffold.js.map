{"version":3,"file":"scaffold.js","sources":["../../src/components/scaffold.gts"],"sourcesContent":["import { fn, hash } from '@ember/helper';\nimport { on } from '@ember/modifier';\nimport { getOwner } from '@ember/owner';\nimport { service } from '@ember/service';\nimport Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { t } from 'ember-intl';\nimport { runTask } from 'ember-lifeline';\nimport { and, or } from 'ember-truth-helpers';\n\nimport AppBar from './app-bar.gts';\nimport ContextMenu, { ContextMenuItem } from './context-menu.gts';\nimport Footer from './footer.gts';\nimport Modal from './modal.gts';\nimport Sidebar from './sidebar.gts';\nimport ThemeControl from './theme-control.gts';\nimport Toaster from './toaster.gts';\nimport version from '../helpers/version.ts';\n\nimport type { AppBarBlock } from './app-bar.gts';\nimport type { Group, Item } from './sidebar.gts';\nimport type { Dropdown as ContextMenuType } from '../services/context-menu.ts';\nimport type ResponsiveService from '../services/responsive.ts';\nimport type ThemeService from '../services/theme.ts';\nimport type { WithBoundArgs } from '@glint/template';\nimport type { IntlService } from 'ember-intl';\n\ntype EnvironmentConfig = Record<string, string> & {\n  modulePrefix: string;\n};\n\nexport interface ScaffoldOptions {\n  contextMenuId: string;\n}\n\nexport interface ScaffoldSignature {\n  Element: HTMLDivElement;\n  Args: {\n    allowThemes?: boolean;\n    contextMenuId?: string;\n    environment?: string;\n    onSidebarToggle?: (open: boolean) => void;\n  };\n  Blocks: {\n    'app-bar-left': [AppBarBlock];\n    'app-bar-right': [AppBarBlock];\n    'context-menu': [ContextMenuType, string];\n    default: [ScaffoldOptions];\n    'footer-left': [];\n    'footer-right': [];\n    about: [];\n    sidebar: [\n      {\n        Item: WithBoundArgs<typeof Item, 'header' | 'onClickInternal'>;\n        Group: WithBoundArgs<typeof Group, 'onClickInternal'>;\n      },\n    ];\n    'sidebar-footer': [WithBoundArgs<typeof Item, 'onClickInternal'>];\n  };\n}\n\nexport default class Scaffold extends Component<ScaffoldSignature> {\n  self: Record<'isDark', boolean> = this;\n\n  @service\n  declare intl: IntlService;\n\n  @service\n  declare responsive: ResponsiveService;\n\n  @service\n  declare theme: ThemeService;\n\n  @tracked\n  showAboutModel = false;\n\n  @tracked\n  _showSidebar?: boolean;\n\n  get showSidebar() {\n    return (\n      this._showSidebar ?? !(this.responsive.isMobileScreenGroup || this.responsive.isMediumScreen)\n    );\n  }\n\n  set showSidebar(value: boolean) {\n    this._showSidebar = value;\n  }\n\n  get allowThemes() {\n    return this.args.allowThemes ?? true;\n  }\n\n  get contextMenuId() {\n    return this.args.contextMenuId ?? 'application';\n  }\n\n  get environmentConfig() {\n    // @ts-expect-error - this is a private API\n    return getOwner(this)!.resolveRegistration('config:environment') as EnvironmentConfig;\n  }\n\n  get sidebarIcon() {\n    if (!this.showSidebar) {\n      return 'list';\n    }\n    return this.responsive.isMobileScreenGroup || this.responsive.isMediumScreen ? 'x-lg' : 'list';\n  }\n\n  get isDark() {\n    return this.theme.value === 'dark';\n  }\n\n  set isDark(value: boolean) {\n    this.theme.value = value ? 'dark' : 'light';\n  }\n\n  toggleSidebar = () => {\n    this.showSidebar = !this.showSidebar;\n    this.args.onSidebarToggle?.(this.showSidebar);\n  };\n\n  toggleAboutModal = (open: boolean) => {\n    this.showAboutModel = open;\n  };\n\n  sidebarClicked = (evt: MouseEvent) => {\n    evt?.preventDefault?.();\n    evt?.stopPropagation?.();\n    if (this.responsive.isMobileScreenGroup) {\n      runTask(this, () => {\n        this.showSidebar = false;\n      });\n    }\n  };\n\n  <template>\n    {{#let (or (has-block \"sidebar\") (has-block \"sidebar-footer\")) as |hasSidebar|}}\n      <div class=\"min-dvh-100 d-flex flex-column\">\n        <AppBar @environment={{@environment}}>\n          <:left as |AppBar|>\n            {{#if hasSidebar}}\n              <i\n                class=\"bi-{{this.sidebarIcon}} fs-4 ps-3\"\n                role=\"button\"\n                {{on \"click\" this.toggleSidebar}}\n              />\n            {{/if}}\n            {{yield AppBar to=\"app-bar-left\"}}\n          </:left>\n          <:right as |AppBar|>\n            {{yield AppBar to=\"app-bar-right\"}}\n\n            {{#if this.allowThemes}}\n              <ContextMenuItem\n                class=\"d-flex justify-content-center align-items-center theme-switcher py-2\"\n                @bottom={{false}}\n                @closeOnSelect={{false}}\n                @menuId={{this.contextMenuId}}\n              >\n                <ThemeControl />\n              </ContextMenuItem>\n              <ContextMenuItem @menuId={{this.contextMenuId}} @divider={{true}} />\n            {{/if}}\n\n            <ContextMenu class=\"pe-2\" @flip={{true}} @id={{this.contextMenuId}}>\n              <:default as |Menu|>\n                {{yield Menu this.contextMenuId to=\"context-menu\"}}\n              </:default>\n            </ContextMenu>\n\n            <Modal\n              class=\"subtle\"\n              @isOpen={{this.showAboutModel}}\n              @onDismiss={{fn this.toggleAboutModal false}}\n            >\n              <:default>\n                {{#if (has-block \"about\")}}\n                  {{yield to=\"about\"}}\n                {{else}}\n                  <div class=\"p-3\">\n                    <h4>\n                      {{this.environmentConfig.modulePrefix}}\n                    </h4>\n                    <span>\n                      {{t \"nrg.app-bar.about.version\" version=(version)}}\n                    </span>\n                  </div>\n                {{/if}}\n              </:default>\n            </Modal>\n            <ContextMenuItem\n              @bottom={{true}}\n              @menuId={{this.contextMenuId}}\n              @onSelect={{fn this.toggleAboutModal true}}\n            >\n              {{t \"nrg.app-bar.about.item\"}}\n            </ContextMenuItem>\n          </:right>\n        </AppBar>\n        <div class=\"application\" ...attributes>\n          <Toaster />\n          {{#if (and hasSidebar this.showSidebar)}}\n            <div class=\"col-12 col-md-3 col-xl-2 d-flex flex-column sticky-top overflow-auto\">\n              {{#if (has-block \"sidebar-footer\")}}\n                <Sidebar @onClickInternal={{this.sidebarClicked}}>\n                  <:default as |Menu|>\n                    {{yield Menu to=\"sidebar\"}}\n                  </:default>\n                  <:footer as |Item|>\n                    {{yield Item to=\"sidebar-footer\"}}\n                  </:footer>\n                </Sidebar>\n              {{else}}\n                <Sidebar @onClickInternal={{this.sidebarClicked}}>\n                  <:default as |Menu|>\n                    {{yield Menu to=\"sidebar\"}}\n                  </:default>\n                </Sidebar>\n              {{/if}}\n            </div>\n          {{/if}}\n          <div\n            class=\"col flex-grow-1 justify-content-between overflow-auto px-md-0 d-flex flex-column\"\n          >\n            <main class=\"col d-flex flex-column\">\n              {{yield (hash contextMenuId=this.contextMenuId)}}\n            </main>\n            {{#if (or (has-block \"footer-left\") (has-block \"footer-right\"))}}\n              <Footer>\n                <:left>\n                  {{yield to=\"footer-left\"}}\n                </:left>\n                <:right>\n                  {{yield to=\"footer-right\"}}\n                </:right>\n              </Footer>\n            {{/if}}\n          </div>\n        </div>\n      </div>\n    {{/let}}\n  </template>\n}\n"],"names":["Scaffold","Component","self","g","prototype","service","i","tracked","showSidebar","_showSidebar","responsive","isMobileScreenGroup","isMediumScreen","value","allowThemes","args","contextMenuId","environmentConfig","getOwner","resolveRegistration","sidebarIcon","isDark","theme","toggleSidebar","onSidebarToggle","toggleAboutModal","open","showAboutModel","sidebarClicked","evt","preventDefault","stopPropagation","runTask","setComponentTemplate","precompileTemplate","strictMode","scope","or","AppBar","on","ContextMenuItem","ThemeControl","ContextMenu","Modal","fn","t","version","Toaster","and","Sidebar","hash","Footer"],"mappings":"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"}