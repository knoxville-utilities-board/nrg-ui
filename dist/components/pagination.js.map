{"version":3,"file":"pagination.js","sources":["../../src/components/pagination.gts"],"sourcesContent":["import { fn } from '@ember/helper';\nimport { on } from '@ember/modifier';\nimport { isTesting, macroCondition } from '@embroider/macros';\nimport Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { restartableTask, timeout } from 'ember-concurrency';\nimport { formatNumber, t } from 'ember-intl';\nimport { TrackedArray } from 'tracked-built-ins';\n\nimport { bind } from '../helpers/bind.ts';\nimport { classes } from '../helpers/classes.ts';\nimport NumberInput from './form/number-input.gts';\nimport Select from './form/select.gts';\n\nimport type { Optional } from '../index.ts';\n\nexport interface Meta {\n  start: string | number;\n  count: string | number;\n  total: string | number;\n}\n\nexport interface PaginationSignature {\n  Element: HTMLUListElement;\n  Args: {\n    compact?: boolean;\n    defaultPageSize?: number;\n    enablePageJump?: boolean;\n    meta?: Meta;\n    pageJumpDebounce?: number;\n    pageSizes?: number[];\n    showDetailedMeta?: boolean;\n\n    onChangePage?: (start: number) => void;\n    onChangePageSize?: (pageSize: number) => void;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\ninterface Page {\n  number?: number;\n  current?: boolean;\n  blank?: boolean;\n}\n\nconst defaultPageSize = 25;\nconst defaultPageJumpDebounce = 600;\n\nexport default class Pagination extends Component<PaginationSignature> {\n  @tracked\n  currentPageNumber = this.currentPage;\n\n  get meta() {\n    const meta = this.args.meta ?? ({} as Meta);\n    const start = parseInt(meta.start as string);\n    const count = parseInt(meta.count as string);\n    const total = parseInt(meta.total as string);\n\n    return {\n      start,\n      count,\n      total,\n    };\n  }\n\n  get defaultPageSize() {\n    return (\n      this.args.defaultPageSize ?? this.args.pageSizes?.[0] ?? defaultPageSize\n    );\n  }\n\n  get selectedPageSize() {\n    return this.meta.count;\n  }\n\n  set selectedPageSize(pageSize: number) {\n    if (pageSize == this.meta.count) {\n      return;\n    }\n    this.currentPageNumber = 1;\n    this.args.onChangePageSize?.(pageSize);\n  }\n\n  get firstPage() {\n    return {\n      number: 1,\n      current: 1 === this.currentPage,\n    };\n  }\n\n  get currentPage() {\n    return this.meta.start / this.selectedPageSize + 1;\n  }\n\n  get totalPages() {\n    return Math.ceil(this.meta.total / this.selectedPageSize);\n  }\n\n  get canStepForward() {\n    return this.currentPage < this.totalPages;\n  }\n\n  get canStepBackward() {\n    return this.currentPage > 1;\n  }\n\n  get currentPageStart() {\n    return this.meta.start + 1;\n  }\n\n  get currentPageEnd() {\n    const pageEnd = this.meta.start + this.meta.count;\n    const total = this.meta.total;\n    return pageEnd > total ? total : pageEnd;\n  }\n\n  get showFirstPage() {\n    return 1 < this.pageItems[0]!.number!;\n  }\n\n  get showLastPage() {\n    return this.pageItems?.every((page) => page?.number !== this.totalPages);\n  }\n\n  get pageItems(): Page[] {\n    const pageList = new TrackedArray<Page>();\n    const totalPages = this.totalPages;\n    const displayedPages = !this.args.compact && totalPages >= 5 ? 5 : 3;\n    const pageRange = (displayedPages - 1) / 2;\n    const first = this.currentPage - pageRange;\n    const last = this.currentPage + pageRange;\n    for (let pageNum = first; pageNum <= last; pageNum++) {\n      if (pageNum > 0 && pageNum <= totalPages) {\n        // Valid page number\n        pageList.push({\n          number: pageNum,\n          current: pageNum === this.currentPage,\n        });\n      } else {\n        pageList.push({\n          current: false,\n          blank: true,\n        });\n      }\n    }\n    return pageList;\n  }\n\n  get pageSizes(): number[] {\n    const pageSizes = new Set(this.args.pageSizes);\n\n    pageSizes.add(this.meta.count);\n\n    return Array.from(pageSizes).sort((a, b) => a - b);\n  }\n\n  get jumpToDebounce() {\n    if (macroCondition(isTesting())) {\n      return 0;\n    }\n    return this.args.pageJumpDebounce ?? defaultPageJumpDebounce;\n  }\n\n  getPageNumberFromStart(start: number) {\n    return start / this.selectedPageSize + 1;\n  }\n\n  getStartFromPageNumber(page: number) {\n    return (page - 1) * this.selectedPageSize;\n  }\n\n  changePage = (page: Page, evt?: Event) => {\n    evt?.preventDefault();\n    evt?.stopPropagation();\n\n    if (!page.current && !page.blank) {\n      this.args.onChangePage?.(this.getStartFromPageNumber(page.number!));\n      this.currentPageNumber = page.number!;\n    }\n  };\n\n  jumpToPage = (page: Optional<number>) => {\n    page = Math.round(page!);\n    this.currentPageNumber = page;\n    if (page != this.currentPage && page > 0) {\n      if (page > this.totalPages) {\n        page = this.totalPages;\n        this.currentPageNumber = page;\n      }\n      this.goToPage.perform(page);\n    }\n  };\n\n  jumpToLastPage = (evt: Event) => {\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    this.jumpToPage(this.totalPages);\n  };\n\n  goToPage = restartableTask(async (page) => {\n    await timeout(this.jumpToDebounce);\n\n    this.args.onChangePage?.(this.getStartFromPageNumber(page));\n  });\n\n  stepForward = (evt: Event) => {\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    if (this.canStepForward) {\n      this.changePage({\n        number: this.currentPage + 1,\n      });\n    }\n  };\n\n  stepBackward = (evt: Event) => {\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    if (this.canStepBackward) {\n      this.changePage({\n        number: this.currentPage - 1,\n      });\n    }\n  };\n\n  <template>\n    <ul class=\"pagination\" role=\"navigation\" ...attributes>\n      {{#if @showDetailedMeta}}\n        <li class=\"page-item disabled\" data-test-meta>\n          <span class=\"page-link\">\n            {{t\n              \"nrg.pagination.detailedMeta\"\n              start=this.currentPageStart\n              end=this.currentPageEnd\n              total=this.meta.total\n            }}\n          </span>\n        </li>\n      {{/if}}\n      <li\n        class={{classes\n          \"page-item page-previous\"\n          (unless this.canStepBackward \"disabled\")\n        }}\n        role={{if this.canStepBackward \"button\"}}\n        {{! template-lint-disable }}\n        {{! When the user can move to the previous page, the appropriate }}\n        {{! role is added. The lint rule does not account for that. }}\n        {{on \"click\" this.stepBackward}}\n        data-test-previous\n      >\n        <span class=\"page-link\">\n          {{t \"nrg.base.previous\"}}\n        </span>\n      </li>\n      {{#each this.pageItems as |page|}}\n        <li\n          aria-current={{if page.current \"page\"}}\n          class={{classes \"page-item\" (if page.current \"active\")}}\n          role={{unless page.blank \"button\"}}\n          {{! template-lint-disable }}\n          {{! When the user can move a specific page, the appropriate }}\n          {{! role is added. The lint rule does not account for that. }}\n          {{on \"click\" (fn this.changePage page)}}\n          data-test-page={{page.number}}\n        >\n          {{#if page.blank}}\n            {{! template-lint-disable no-whitespace-for-layout }}\n            <span aria-hidden=\"true\" class=\"page-link disabled\">\n              &nbsp;&nbsp;\n            </span>\n          {{else}}\n            <span class=\"page-link\">\n              {{formatNumber page.number}}\n            </span>\n          {{/if}}\n        </li>\n      {{/each}}\n      <li\n        class={{classes\n          \"page-item page-next\"\n          (unless this.canStepForward \"disabled\")\n        }}\n        role={{if this.canStepForward \"button\"}}\n        {{! template-lint-disable }}\n        {{! When the user can move to the next page, the appropriate }}\n        {{! role is added. The lint rule does not account for that. }}\n        {{on \"click\" this.stepForward}}\n        data-test-next\n      >\n        <span class=\"page-link\">\n          {{t \"nrg.base.next\"}}\n        </span>\n      </li>\n      {{#if @pageSizes}}\n        <li class=\"page-item\" data-test-page-sizes>\n          <Select\n            @binding={{bind this \"selectedPageSize\"}}\n            @options={{this.pageSizes}}\n            @useDefaultValue={{true}}\n            @defaultValue={{this.defaultPageSize}}\n          >\n            <:option as |value|>\n              {{t \"nrg.pagination.pageSize\" value=value}}\n            </:option>\n          </Select>\n        </li>\n      {{/if}}\n      {{#if @enablePageJump}}\n        <li class=\"page-item\" data-test-jump-to>\n          <span class=\"input-group-text\">\n            {{t \"nrg.pagination.jumpToPage.start\"}}\n            <NumberInput\n              class=\"py-0 text-end me-1\"\n              max={{this.totalPages}}\n              @basic={{true}}\n              @binding={{bind this \"currentPageNumber\"}}\n              @onChange={{this.jumpToPage}}\n            />\n            {{t \"nrg.pagination.jumpToPage.end\" total=this.totalPages}}\n          </span>\n        </li>\n      {{/if}}\n    </ul>\n  </template>\n}\n"],"names":["defaultPageSize","defaultPageJumpDebounce","Pagination","Component","g","prototype","tracked","currentPage","i","meta","args","start","parseInt","count","total","pageSizes","selectedPageSize","pageSize","currentPageNumber","onChangePageSize","firstPage","number","current","totalPages","Math","ceil","canStepForward","canStepBackward","currentPageStart","currentPageEnd","pageEnd","showFirstPage","pageItems","showLastPage","every","page","pageList","TrackedArray","displayedPages","compact","pageRange","first","last","pageNum","push","blank","Set","add","Array","from","sort","a","b","jumpToDebounce","macroCondition","isTesting","pageJumpDebounce","getPageNumberFromStart","getStartFromPageNumber","changePage","evt","preventDefault","stopPropagation","onChangePage","jumpToPage","round","goToPage","perform","jumpToLastPage","_buildTask","context","generator","timeout","stepForward","stepBackward","setComponentTemplate","precompileTemplate","strictMode","scope","t","classes","on","fn","formatNumber","Select","bind","NumberInput"],"mappings":"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"}