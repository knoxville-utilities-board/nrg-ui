{"version":3,"file":"search.js","sources":["../../../src/components/form/search.gts"],"sourcesContent":["import { fn, hash } from '@ember/helper';\nimport { on } from '@ember/modifier';\nimport { action, get } from '@ember/object';\nimport { service } from '@ember/service';\nimport { isTesting, macroCondition } from '@embroider/macros';\nimport { tracked } from '@glimmer/tracking';\nimport { restartableTask, timeout } from 'ember-concurrency';\nimport { t } from 'ember-intl';\n// @ts-expect-error Ember keyboard doesn't currently ship a type for the `on-key` modifier\n// https://github.com/adopted-ember-addons/ember-keyboard/issues/464\nimport onKey from 'ember-keyboard/modifiers/on-key';\nimport { eq } from 'ember-truth-helpers';\n\nimport Dropdown from './../dropdown.gts';\nimport TextInput from './../form/text-input.gts';\nimport BoundValue from './bound-value.ts';\nimport { bind } from '../../helpers/bind.ts';\nimport { classes } from '../../helpers/classes.ts';\nimport onInsert from '../../modifiers/on-insert.ts';\nimport Button from '../button.gts';\n\nimport type { Optional } from '../../index.ts';\nimport type { Direction, PopoverVisibility } from '../popover.ts';\nimport type { FieldOptions } from './field.gts';\nimport type IntlService from 'ember-intl/services/intl';\n\ndeclare type SearchOption<T> = {\n  label: string;\n  value: string | T;\n  raw: T;\n};\n\nexport interface SearchSignature<T> {\n  Element: HTMLDivElement;\n  Args: {\n    basic?: boolean;\n    clearable?: boolean;\n    displayPath?: string;\n    format?: ((value: Optional<string>) => string) | false;\n    hideSearchIcon?: boolean;\n    loading?: boolean;\n    minCharacters?: number;\n    noResultsLabel?: string;\n    placeholder?: string;\n    readonly?: boolean;\n    scrollable?: boolean;\n    searchTimeout?: number;\n    serializationPath?: string;\n    side?: Direction;\n\n    fieldOptions?: FieldOptions;\n\n    onShow?: () => unknown | Promise<unknown>;\n    onHide?: () => unknown | Promise<unknown>;\n    onQuery?: (searchString: string) => Promise<T[]> | T[];\n  };\n  Blocks: {\n    option: [T];\n  };\n}\n\nexport default class Search<T> extends BoundValue<SearchSignature<T>, string | T> {\n  self: Record<'searchString' | 'displayValue', string> = this;\n  declare visibility: PopoverVisibility;\n  declare inputElement: HTMLInputElement;\n  declare menuElement: HTMLElement;\n\n  @tracked\n  activeIndex = -1;\n\n  @tracked\n  options: T[] = [];\n\n  @tracked\n  searchString = '';\n\n  @service\n  declare intl: IntlService;\n\n  get clearable() {\n    if (this.args.basic) {\n      return false;\n    }\n\n    return this.args.clearable ?? false;\n  }\n\n  get hideSearchIcon() {\n    if (this.args.basic) {\n      return true;\n    }\n\n    return this.args.hideSearchIcon ?? false;\n  }\n\n  get loading() {\n    return this.args.loading || this.query.isRunning;\n  }\n\n  get minCharacters() {\n    return this.args.minCharacters ?? 1;\n  }\n\n  get noResultsLabel() {\n    return this.args.noResultsLabel ?? this.intl.t('nrg.search.noResults');\n  }\n\n  get placeholder() {\n    if (this.args.basic) {\n      return '';\n    }\n\n    return this.args.placeholder ?? this.intl.t('nrg.search.placeholder');\n  }\n\n  get scrollable() {\n    return this.args.scrollable ?? true;\n  }\n\n  get searchTimeout() {\n    if (macroCondition(isTesting())) {\n      return 0;\n    }\n\n    return this.args.searchTimeout ?? 300;\n  }\n\n  get canPerformSearch() {\n    return this.searchString.trim().length >= this.minCharacters;\n  }\n\n  get inputClassList() {\n    const classes = ['form-control'];\n\n    if (this.args.basic) {\n      classes[0] += '-plaintext';\n    }\n\n    if (this.args.fieldOptions?.isInvalid) {\n      classes.push('is-invalid');\n    } else if (this.args.fieldOptions?.isWarning) {\n      classes.push('is-warning');\n    }\n\n    return classes.join(' ');\n  }\n\n  get displayValue(): string {\n    const { value } = this;\n    const isStringValue = typeof value === 'string';\n    const isStringOption = typeof this.selectedOption?.value === 'string';\n\n    if (!value) {\n      return '';\n    }\n\n    if (\n      isStringValue ||\n      (isStringOption && (!this.internalOptions.length || this.query.isRunning))\n    ) {\n      return value as string;\n    }\n\n    if (this.args.serializationPath === null) {\n      return get(value, this.args.displayPath ?? 'label') as string;\n    }\n\n    if (this.selectedOption) {\n      return this.selectedOption.label;\n    }\n\n    return '';\n  }\n\n  get internalOptions() {\n    return this.options.map((option) => {\n      if (typeof option !== 'object') {\n        return {\n          raw: option,\n          label: option as string,\n          value: option as string,\n        };\n      }\n\n      const label = get(option, this.args.displayPath ?? 'label') as string;\n      let value: string | T = option;\n      // null serializationPath results in value being the raw option\n      if (this.args.serializationPath !== null) {\n        value = get(option, this.args.serializationPath ?? 'value') as string;\n      }\n      return {\n        raw: option,\n        label,\n        value,\n      };\n    });\n  }\n\n  get selectedOption(): Optional<SearchOption<T>> {\n    const found = this.internalOptions.find((option) => option.value === this.value);\n    return found || null;\n  }\n\n  set selectedOption(option: SearchOption<T>) {\n    this.onChange(option.value);\n  }\n\n  get isInputElementActive() {\n    return this.inputElement === document.activeElement;\n  }\n\n  get inputValue() {\n    return this.isInputElementActive ? this.searchString : this.displayValue;\n  }\n\n  set inputValue(searchString: string) {\n    this.query.perform(searchString);\n  }\n\n  scrollActiveOptionIntoView() {\n    if (this.activeIndex == -1) {\n      return;\n    }\n    const childElements = Array.from(this.menuElement.querySelectorAll(`li`) ?? []);\n    const activeElement = childElements[this.activeIndex];\n    if (!activeElement) {\n      return;\n    }\n    activeElement.scrollIntoView({ block: 'nearest' });\n  }\n\n  query = restartableTask(async (searchString) => {\n    this.searchString = searchString;\n    this.activeIndex = -1;\n\n    if (!this.canPerformSearch) {\n      this.visibility.hide();\n      return;\n    }\n\n    await timeout(this.searchTimeout);\n    this.options = (await this.args.onQuery?.(searchString)) ?? [];\n    this.visibility.show(this.inputElement);\n  });\n\n  @action\n  selectOption(option: SearchOption<T>, index: number, evt?: Event) {\n    evt?.preventDefault();\n    evt?.stopPropagation();\n\n    this.activeIndex = index;\n    this.selectedOption = option;\n\n    this.onBlur();\n  }\n\n  @action\n  moveUp(evt: KeyboardEvent) {\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    if (this.activeIndex > 0) {\n      this.activeIndex--;\n      this.scrollActiveOptionIntoView();\n    }\n  }\n\n  @action\n  moveDown(evt: KeyboardEvent) {\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    if (this.activeIndex < this.options.length - 1) {\n      this.activeIndex++;\n      this.scrollActiveOptionIntoView();\n    }\n  }\n\n  @action\n  enterKeyHandler(evt?: KeyboardEvent) {\n    evt?.preventDefault();\n    evt?.stopPropagation();\n\n    if (this.activeIndex == -1) {\n      return;\n    }\n\n    const option = this.internalOptions[this.activeIndex];\n\n    if (option != undefined) {\n      this.selectOption(option, this.activeIndex);\n    }\n  }\n\n  @action\n  exitKeyHandler(evt?: KeyboardEvent) {\n    evt?.preventDefault();\n    evt?.stopPropagation();\n\n    this.onBlur();\n  }\n\n  @action\n  onFocus(evt: FocusEvent) {\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    this.searchString = this.displayValue;\n  }\n\n  @action\n  onBlur() {\n    this.visibility.hide();\n    this.inputElement.blur();\n  }\n\n  @action\n  onMouseDown(evt: MouseEvent) {\n    evt.preventDefault();\n    evt.stopPropagation();\n\n    this.inputElement.focus();\n  }\n\n  @action\n  clear() {\n    this.searchString = '';\n    this.activeIndex = -1;\n    this.onChange(null);\n\n    this.onBlur();\n  }\n\n  @action\n  onSearchBarInsert(element: HTMLElement) {\n    this.inputElement = element as HTMLInputElement;\n  }\n\n  @action\n  onMenuInsert(element: HTMLElement) {\n    this.menuElement = element;\n  }\n\n  @action\n  setVisibility(visibility: PopoverVisibility) {\n    this.visibility = visibility;\n  }\n\n  <template>\n    <Dropdown\n      @fullWidth={{true}}\n      @side={{@side}}\n      @onShow={{@onShow}}\n      @onHide={{@onHide}}\n      @scrollable={{this.scrollable}}\n      {{onInsert this.onMenuInsert}}\n    >\n      <:control as |visibility|>\n        <div\n          class={{classes\n            \"search\"\n            (if @fieldOptions.isInvalid \"is-invalid\")\n            (if @fieldOptions.isWarning \"is-warning\")\n          }}\n          {{onInsert (fn this.setVisibility visibility)}}\n          ...attributes\n        >\n          <div class=\"input-group\">\n            {{#unless this.hideSearchIcon}}\n              <span class=\"input-group-text\">\n                {{#if this.loading}}\n                  <span class=\"spinner-border spinner-border-sm\" />\n                {{else}}\n                  <i class=\"bi bi-search\" />\n                {{/if}}\n              </span>\n            {{/unless}}\n            <TextInput\n              class={{this.inputClassList}}\n              placeholder={{this.placeholder}}\n              @basic={{@basic}}\n              @binding={{bind this.self \"inputValue\"}}\n              @fieldOptions={{hash\n                describedBy=@fieldOptions.describedBy\n                disabled=@fieldOptions.disabled\n                id=@fieldOptions.id\n                isInvalid=@fieldOptions.isInvalid\n                isWarning=@fieldOptions.isWarning\n                required=@fieldOptions.required\n              }}\n              @readonly={{@readonly}}\n              {{on \"focus\" this.onFocus}}\n              {{onKey \"ArrowUp\" this.moveUp onlyWhenFocused=true}}\n              {{onKey \"ArrowDown\" this.moveDown onlyWhenFocused=true}}\n              {{onKey \"Enter\" this.enterKeyHandler onlyWhenFocused=true}}\n              {{onKey \"NumpadEnter\" this.enterKeyHandler onlyWhenFocused=true}}\n              {{onKey \"Tab\" this.exitKeyHandler onlyWhenFocused=true}}\n              {{onKey \"Escape\" this.exitKeyHandler onlyWhenFocused=true}}\n              {{onInsert this.onSearchBarInsert}}\n            />\n            {{#if this.clearable}}\n              <Button\n                aria-label={{t \"nrg.base.clear\"}}\n                class=\"btn-outline-secondary\"\n                @onClick={{this.clear}}\n              >\n                <i class=\"bi bi-x-lg\" />\n              </Button>\n            {{/if}}\n          </div>\n        </div>\n      </:control>\n      <:menu as |Menu|>\n        {{#each this.internalOptions as |option index|}}\n          {{#let (eq this.activeIndex index) as |isActive|}}\n            <Menu.Item\n              aria-selected={{isActive}}\n              class={{if isActive \"active\"}}\n              @onSelect={{fn this.selectOption option index}}\n              {{! template-lint-disable no-pointer-down-event-binding }}\n              {{on \"mousedown\" this.onMouseDown}}\n            >\n              {{#if (has-block \"option\")}}\n                {{yield option.raw to=\"option\"}}\n              {{else}}\n                {{option.label}}\n              {{/if}}\n            </Menu.Item>\n          {{/let}}\n        {{else}}\n          <Menu.Item @disabled={{true}}>\n            {{this.noResultsLabel}}\n          </Menu.Item>\n        {{/each}}\n      </:menu>\n    </Dropdown>\n  </template>\n}\n"],"names":["Search","BoundValue","self","g","prototype","tracked","i","service","clearable","args","basic","hideSearchIcon","loading","query","isRunning","minCharacters","noResultsLabel","intl","t","placeholder","scrollable","searchTimeout","macroCondition","isTesting","canPerformSearch","searchString","trim","length","inputClassList","classes","fieldOptions","isInvalid","push","isWarning","join","displayValue","value","isStringValue","isStringOption","selectedOption","internalOptions","serializationPath","get","displayPath","label","options","map","option","raw","found","find","onChange","isInputElementActive","inputElement","document","activeElement","inputValue","perform","scrollActiveOptionIntoView","activeIndex","childElements","Array","from","menuElement","querySelectorAll","scrollIntoView","block","_buildTask","context","generator","visibility","hide","timeout","onQuery","show","selectOption","index","evt","preventDefault","stopPropagation","onBlur","n","action","moveUp","moveDown","enterKeyHandler","undefined","exitKeyHandler","onFocus","blur","onMouseDown","focus","clear","onSearchBarInsert","element","onMenuInsert","setVisibility","setComponentTemplate","precompileTemplate","strictMode","scope","Dropdown","onInsert","fn","TextInput","bind","hash","on","onKey","Button","eq"],"mappings":"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"}