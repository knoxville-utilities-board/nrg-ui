{"version":3,"file":"index.js","sources":["../../../src/components/form/index.gts"],"sourcesContent":["import { runInDebug, warn } from '@ember/debug';\nimport { hash } from '@ember/helper';\nimport { on } from '@ember/modifier';\nimport { action } from '@ember/object';\nimport Component from '@glimmer/component';\nimport { cached, tracked } from '@glimmer/tracking';\nimport { dropTask } from 'ember-concurrency';\nimport perform from 'ember-concurrency/helpers/perform';\nimport { runTask } from 'ember-lifeline';\nimport { TrackedArray, TrackedMap } from 'tracked-built-ins';\n\nimport Field from './field.gts';\nimport onInsert from '../../modifiers/on-insert.ts';\nimport { scrollTo } from '../../utils/dom.ts';\nimport { diff, uid } from '../../utils/index.ts';\nimport Button from '../button.gts';\n\nimport type { FieldSignature } from './field.gts';\nimport type { Binding } from '../../index.ts';\nimport type { Validator, ValidatorImpl } from '../../validation/types';\nimport type { ButtonSignature } from '../button.gts';\nimport type Owner from '@ember/owner';\nimport type { ComponentLike } from '@glint/template';\n\ntype Wrapper = {\n  id: string;\n  v: ValidatorImpl<unknown, object, object>;\n};\nexport type ValidatorsObject = Record<string, Validator | Validator[]>;\n\nexport interface FormType {\n  didValidate: boolean;\n\n  isValidFor(name: string): boolean;\n  errorFor(name: string): string | undefined;\n  warningFor(name: string): string | undefined;\n  registerBinding(binding: Binding<object>, name?: string): void;\n  unregisterBinding(name: string): void;\n  registerValidator(validator: ValidatorImpl<unknown, object, object>, name?: string): string;\n  unregisterValidator(name: string, id: string): void;\n}\n\nexport interface FormState {\n  isValid: boolean;\n}\n\nexport interface FormSignature {\n  Element: HTMLFormElement;\n  Args: {\n    didValidate?: boolean;\n    disabled?: boolean;\n    loading?: boolean;\n    preventScroll?: boolean;\n    submitClass?: string;\n    validators?: ValidatorsObject;\n\n    willValidate?: (event: SubmitEvent) => unknown;\n    onSubmit?: (event: SubmitEvent) => unknown;\n  };\n  Blocks: {\n    default: [\n      {\n        Field: ComponentLike<FieldSignature>;\n        SubmitButton: ComponentLike<ButtonSignature>;\n      },\n      FormState,\n    ];\n  };\n}\n\nexport default class Form extends Component<FormSignature> implements FormType {\n  @tracked\n  _didValidate = false;\n\n  @tracked\n  declare element: HTMLElement;\n\n  staticValidations: Map<string, Wrapper[]>;\n  bindings: Map<string, Binding>;\n\n  constructor(owner: Owner, args: FormSignature['Args']) {\n    super(owner, args);\n\n    this.staticValidations = new TrackedMap();\n    this.bindings = new TrackedMap();\n  }\n\n  get didValidate() {\n    return this.args.didValidate ?? this._didValidate;\n  }\n\n  get loading() {\n    return this.args.loading ?? this.submit.isRunning;\n  }\n\n  @cached\n  get validations(): Map<string, Wrapper[]> {\n    const { validators } = this.args;\n    if (!validators) {\n      return this.staticValidations;\n    }\n\n    const { bindings } = this;\n    const builtValidations = new Map<string, Wrapper[]>();\n\n    for (const [key, value] of this.staticValidations) {\n      builtValidations.set(key, value);\n    }\n\n    for (const entry of Object.entries(validators)) {\n      const [key] = entry;\n      let value = entry[1];\n      const binding = bindings.get(key);\n      if (!binding) {\n        warn(`No binding found for validator '${key}'`, false, {\n          id: 'nrg.form.missing-binding',\n        });\n        continue;\n      }\n      if (!builtValidations.has(key)) {\n        builtValidations.set(key, []);\n      }\n      if (!Array.isArray(value)) {\n        value = [value];\n      }\n      for (const validator of value) {\n        const v = validator(binding, binding.model);\n        const id = uid();\n        builtValidations.get(key)!.push({ id, v });\n      }\n    }\n\n    return builtValidations;\n  }\n\n  get isValid() {\n    runInDebug(() => {\n      this.checkValidations();\n    });\n\n    const validations = Array.from(this.validations.values()).flat();\n    return validations\n      .filter((validator) => !validator.v.result.isWarning)\n      .every((validator) => validator.v.result.isValid);\n  }\n\n  get submitButtonClass() {\n    return this.args.submitClass ?? 'btn-primary';\n  }\n\n  submit = dropTask(async (event: SubmitEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    this.args.willValidate?.(event);\n\n    if (!this.isValid) {\n      this._didValidate = true;\n      if (!this.args.preventScroll) {\n        runTask(this, () => {\n          const invalidField = this.element.querySelector('.is-invalid') as HTMLElement;\n\n          const label = this.element.querySelector(\n            `[for=\"${invalidField?.id}\"]`,\n          ) as HTMLElement | null;\n\n          const fieldY = invalidField?.getBoundingClientRect().top ?? 0;\n          const labelY = label?.getBoundingClientRect().top ?? Infinity;\n\n          scrollTo(fieldY < labelY ? invalidField : label!);\n        });\n      }\n      return;\n    }\n\n    await this.args.onSubmit?.(event);\n\n    // TODO: Anything that needs to be done after the form is submitted\n  });\n\n  @action\n  registerBinding(binding: Binding, name?: string) {\n    this.bindings.set(name ?? binding.valuePath, binding);\n  }\n\n  @action\n  unregisterBinding(name: string) {\n    this.bindings.delete(name);\n  }\n\n  @action\n  registerValidator(validator: ValidatorImpl<unknown, object, object>, name?: string): string {\n    const id = uid();\n    name ??= validator.binding.valuePath;\n    runTask(this, () => {\n      if (!this.staticValidations.has(name)) {\n        this.staticValidations.set(name, new TrackedArray());\n      }\n      this.staticValidations.get(name)!.push({ id, v: validator });\n    });\n\n    return id;\n  }\n\n  @action\n  unregisterValidator(name: string, id: string) {\n    if (!this.staticValidations.has(name)) {\n      return;\n    }\n\n    const validations = this.staticValidations.get(name)!;\n    const index = validations.findIndex((v) => v.id === id);\n    if (index === -1) {\n      return;\n    }\n\n    validations.splice(index, 1);\n  }\n\n  @action\n  setElement(element: HTMLElement) {\n    this.element = element;\n  }\n\n  checkValidations() {\n    const validationKeys = new Set(this.validations.keys());\n    const bindingKeys = new Set(this.bindings.keys());\n\n    const [noBindings, noValidations] = diff(Array.from(validationKeys), Array.from(bindingKeys));\n\n    warn(\n      'The following validations have no binding defined: ' + noBindings.join(', '),\n      noBindings.length === 0,\n      { id: 'nrg.form.missing-validations' },\n    );\n\n    warn(\n      'The following bindings have no validations defined: ' + noValidations.join(', '),\n      noValidations.length === 0,\n      { id: 'nrg.form.missing-bindings' },\n    );\n  }\n\n  isValidFor(name: string) {\n    const validators = this.validations.get(name);\n    if (!validators) {\n      return true;\n    }\n\n    return validators.every((validator) => validator.v.result.isValid);\n  }\n\n  errorFor(name: string) {\n    const validators = this.validations.get(name);\n    if (!validators) {\n      return undefined;\n    }\n\n    const error = validators.find(\n      (validator) => !validator.v.result.isValid && !validator.v.result.isWarning,\n    );\n\n    if (!error) {\n      return undefined;\n    }\n\n    return error.v.result.message;\n  }\n\n  warningFor(name: string) {\n    const validators = this.validations.get(name);\n    if (!validators) {\n      return undefined;\n    }\n\n    const warning = validators.find(\n      (validator) => !validator.v.result.isValid && validator.v.result.isWarning,\n    );\n\n    if (!warning) {\n      return undefined;\n    }\n\n    return warning.v.result.message;\n  }\n\n  <template>\n    <form {{on \"submit\" (perform this.submit)}} {{onInsert this.setElement}} ...attributes>\n      {{yield\n        (hash\n          Field=(component Field disabled=@disabled form=this)\n          SubmitButton=(component\n            Button\n            _class=this.submitButtonClass\n            disabled=@disabled\n            loading=this.loading\n            text=\"Submit\"\n            type=\"submit\"\n          )\n        )\n        (hash isValid=this.isValid)\n      }}\n    </form>\n  </template>\n}\n"],"names":["Form","Component","g","prototype","tracked","i","staticValidations","bindings","constructor","owner","args","TrackedMap","didValidate","_didValidate","loading","submit","isRunning","validations","validators","builtValidations","Map","key","value","set","entry","Object","entries","binding","get","warn","id","has","Array","isArray","validator","v","model","uid","push","n","cached","isValid","runInDebug","checkValidations","from","values","flat","filter","result","isWarning","every","submitButtonClass","submitClass","_buildTask","context","generator","event","preventDefault","stopPropagation","willValidate","preventScroll","runTask","invalidField","element","querySelector","label","fieldY","getBoundingClientRect","top","labelY","Infinity","scrollTo","onSubmit","registerBinding","name","valuePath","action","unregisterBinding","delete","registerValidator","TrackedArray","unregisterValidator","index","findIndex","splice","setElement","validationKeys","Set","keys","bindingKeys","noBindings","noValidations","diff","join","length","isValidFor","errorFor","undefined","error","find","message","warningFor","warning","setComponentTemplate","precompileTemplate","strictMode","scope","on","perform","onInsert","hash","Field","Button"],"mappings":"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"}