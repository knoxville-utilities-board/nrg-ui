{"version":3,"file":"number-input.js","sources":["../../../src/components/form/number-input.gts"],"sourcesContent":["import { fn } from '@ember/helper';\nimport { on } from '@ember/modifier';\nimport { action } from '@ember/object';\nimport { service } from '@ember/service';\nimport { isEmpty, isNone } from '@ember/utils';\nimport { tracked } from '@glimmer/tracking';\nimport { runTask } from 'ember-lifeline';\n\nimport InputField from './-private/input-field.ts';\n\nimport type { Optional } from '../../index.ts';\nimport type { IntlService } from 'ember-intl';\n\nexport interface NumberInputArgs {\n  allowBlank?: boolean;\n  allowDecimals?: boolean;\n  format?: ((value: Optional<number>) => string) | 'number' | 'currency' | 'percent' | false;\n  formatPrecision?: number;\n}\n\nexport default class NumberInput extends InputField<NumberInputArgs, number> {\n  @tracked\n  isFocused = false;\n\n  @tracked\n  displayString = true;\n\n  @service\n  declare intl: IntlService;\n\n  get format() {\n    return this.args.format ?? 'number';\n  }\n\n  get displayValue() {\n    const { displayString, format } = this;\n\n    if (!displayString || !format || isNone(this.value)) {\n      return this.value;\n    }\n\n    if (typeof format === 'function') {\n      return format(this.value);\n    }\n\n    const formatPrecision = this.args.formatPrecision;\n    const options = {\n      maximumFractionDigits: formatPrecision,\n      minimumFractionDigits: formatPrecision,\n    };\n\n    switch (format) {\n      case 'currency':\n        return this.intl.formatNumber(this.value, {\n          style: 'currency',\n          currency: 'USD',\n          ...options,\n        });\n      case 'percent':\n        return this.intl.formatNumber((this.value ?? 0) / 100.0, {\n          style: 'percent',\n          ...options,\n        });\n      default:\n        return this.intl.formatNumber(this.value, {\n          ...options,\n        });\n    }\n  }\n\n  get allowDecimals() {\n    return this.args.allowDecimals ?? true;\n  }\n\n  @action\n  change(event: Event): void {\n    const { allowDecimals } = this;\n    const target = event.target as HTMLInputElement;\n    let newValue = target.value;\n\n    if (isEmpty(newValue)) {\n      if (!this.args.allowBlank) {\n        this.onChange(this.defaultValue ?? 0);\n      }\n      this.onChange(null);\n      return;\n    }\n\n    newValue = newValue.replace(/^([+-]?)(\\d+)(\\.?\\d+)?$/, '$1$2$3');\n\n    let numericValue: Optional<number> = parseFloat(newValue);\n\n    if (isNaN(numericValue)) {\n      numericValue = this.defaultValue;\n    }\n\n    if (!allowDecimals) {\n      // @ts-expect-error - `null` is coerced to `0`\n      numericValue = Math.trunc(numericValue);\n    }\n\n    this.onChange(numericValue);\n  }\n\n  @action\n  toggleFocus(focused: boolean): void {\n    this.isFocused = focused;\n\n    if (focused) {\n      this.displayString = false;\n    } else {\n      runTask(this, () => {\n        this.displayString = true;\n      });\n    }\n  }\n\n  <template>\n    <input\n      aria-describedby={{@fieldOptions.describedBy}}\n      class={{this.classList}}\n      disabled={{@fieldOptions.disabled}}\n      id={{@fieldOptions.id}}\n      readonly={{@readonly}}\n      type={{if this.isFocused \"number\" \"text\"}}\n      value={{this.displayValue}}\n      {{on \"input\" this.change}}\n      {{on \"focus\" (fn this.toggleFocus true)}}\n      {{on \"blur\" (fn this.toggleFocus false)}}\n      ...attributes\n    />\n  </template>\n}\n"],"names":["NumberInput","InputField","g","prototype","tracked","i","service","format","args","displayValue","displayString","isNone","value","formatPrecision","options","maximumFractionDigits","minimumFractionDigits","intl","formatNumber","style","currency","allowDecimals","change","event","target","newValue","isEmpty","allowBlank","onChange","defaultValue","replace","numericValue","parseFloat","isNaN","Math","trunc","n","action","toggleFocus","focused","isFocused","runTask","setComponentTemplate","precompileTemplate","strictMode","scope","on","fn"],"mappings":"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"}