{"version":3,"file":"field.js","sources":["../../../src/components/form/field.gts"],"sourcesContent":["import { registerDestructor } from '@ember/destroyable';\nimport { hash } from '@ember/helper';\nimport { action } from '@ember/object';\nimport Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { tKey } from 'ember-intl';\nimport { runTask } from 'ember-lifeline';\nimport { modifier } from 'ember-modifier';\n\nimport CheckboxGroup from './checkbox-group.gts';\nimport Checkbox from './checkbox.gts';\nimport Datetime from './datetime.gts';\nimport FileUpload from './file-upload.gts';\nimport MultiSelect from './multi-select.gts';\nimport NumberInput from './number-input.gts';\nimport PhoneInput from './phone-input.gts';\nimport RadioGroup from './radio-group.gts';\nimport Search from './search.gts';\nimport Select from './select.gts';\nimport TextArea from './text-area.gts';\nimport TextInput from './text-input.gts';\nimport { PresenceValidator } from '../../validation/index.ts';\n\nimport type { CheckboxGroupSignature } from './checkbox-group.gts';\nimport type { CheckboxSignature } from './checkbox.gts';\nimport type { DatetimeSignature } from './datetime.gts';\nimport type { FileUploadSignature } from './file-upload.gts';\nimport type { FormType } from './index.gts';\nimport type { MultiSelectSignature } from './multi-select.gts';\nimport type { NumberInputArgs } from './number-input.gts';\nimport type { PhoneInputArgs } from './phone-input.gts';\nimport type { RadioGroupSignature } from './radio-group.gts';\nimport type { SearchSignature } from './search.gts';\nimport type { SelectSignature } from './select.gts';\nimport type { TextAreaSignature } from './text-area.gts';\nimport type { Binding } from '../../index.ts';\nimport type { InputFieldSignature } from './-private/input-field.ts';\nimport type { TextInputArgs } from './text-input.gts';\nimport type Owner from '@ember/owner';\nimport type { ComponentLike, WithBoundArgs } from '@glint/template';\n\ndeclare interface TextSignature {\n  Element: HTMLDivElement;\n  Args: {\n    id?: string;\n    field: Field;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\nexport interface FieldSignature {\n  Element: HTMLLabelElement;\n  Args: {\n    disabled?: boolean;\n    form?: FormType;\n    label?: string;\n    required?: boolean;\n    validatorKey?: string;\n  };\n  Blocks: {\n    default: [\n      {\n        Checkbox: ComponentLike<CheckboxSignature>;\n        CheckboxGroup: ComponentLike<CheckboxGroupSignature>;\n        Datetime: ComponentLike<DatetimeSignature>;\n        FileUpload: ComponentLike<FileUploadSignature>;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        MultiSelect: ComponentLike<MultiSelectSignature<any>>;\n        NumberInput: ComponentLike<InputFieldSignature<NumberInputArgs, number>>;\n        PhoneInput: ComponentLike<InputFieldSignature<PhoneInputArgs>>;\n        RadioGroup: ComponentLike<RadioGroupSignature>;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        Search: ComponentLike<SearchSignature<any>>;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        Select: ComponentLike<SelectSignature<any>>;\n        Text: WithBoundArgs<ComponentLike<TextSignature>, 'field'>;\n        TextArea: ComponentLike<TextAreaSignature>;\n        TextInput: ComponentLike<InputFieldSignature<TextInputArgs>>;\n      },\n      FieldOptions,\n    ];\n  };\n}\n\nclass Text extends Component<TextSignature> {\n  constructor(owner: Owner, args: TextSignature['Args']) {\n    super(owner, args);\n\n    runTask(this, () => {\n      args.field.hasText = true;\n    });\n\n    registerDestructor(this, () => {\n      args.field.hasText = false;\n    });\n  }\n\n  <template>\n    <div class=\"form-text\" id={{@id}} ...attributes>\n      {{yield}}\n    </div>\n  </template>\n}\n\nexport interface FieldOptions {\n  describedBy?: string;\n  disabled?: boolean;\n  form?: FormType;\n  id?: string;\n  initBinding?: (binding: Binding) => void;\n  isInvalid?: boolean;\n  isWarning?: boolean;\n  required?: boolean;\n  validatorKey?: string;\n}\n\nexport default class Field extends Component<FieldSignature> {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  TypedSearch = Search<any>;\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  TypedSelect = Select<any>;\n\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  TypedMultiSelect = MultiSelect<any>;\n\n  @tracked\n  hasText = false;\n\n  @tracked\n  fieldId = crypto.randomUUID();\n\n  @tracked\n  messageId = crypto.randomUUID();\n\n  @tracked\n  textId = crypto.randomUUID();\n\n  requiredId?: string;\n\n  @tracked\n  binding!: Binding;\n\n  constructor(owner: Owner, args: FieldSignature['Args']) {\n    super(owner, args);\n\n    registerDestructor(this, () => {\n      this.setupValidator();\n    });\n  }\n\n  get isValid() {\n    const { form } = this.args;\n\n    if (!form || !form.didValidate) {\n      return undefined;\n    }\n\n    return form.isValidFor(this.validatorKey);\n  }\n\n  get hasError() {\n    return typeof this.errorMessage === 'string';\n  }\n\n  get hasWarning() {\n    return typeof this.warningMessage === 'string';\n  }\n\n  get errorMessage() {\n    const { form } = this.args;\n\n    if (!form || !form.didValidate) {\n      return undefined;\n    }\n\n    return form.errorFor(this.validatorKey);\n  }\n\n  get warningMessage() {\n    const { form } = this.args;\n\n    if (!form) {\n      return undefined;\n    }\n\n    return form.warningFor(this.validatorKey);\n  }\n\n  get validatorKey() {\n    return this.args.validatorKey ?? this.binding?.valuePath;\n  }\n\n  get describedBy() {\n    const describedBy = [];\n\n    if (this.hasError || this.hasWarning) {\n      describedBy.push(this.messageId);\n    }\n\n    if (this.hasText) {\n      describedBy.push(this.textId);\n    }\n\n    return describedBy.join(' ');\n  }\n\n  @action\n  initBinding(binding: Binding) {\n    const { form } = this.args;\n    if (!form) {\n      return;\n    }\n    if (this.binding) {\n      form.unregisterBinding(this.validatorKey);\n      form.unregisterValidator(this.validatorKey, this.requiredId!);\n    }\n\n    this.binding = binding;\n\n    form.registerBinding(binding, this.validatorKey);\n  }\n\n  @action\n  setupValidator(required?: boolean) {\n    const { binding, requiredId } = this;\n    const { form } = this.args;\n\n    if (!form || !binding) {\n      return;\n    }\n\n    if (required) {\n      if (requiredId) {\n        return;\n      }\n\n      let key;\n\n      if (binding.model instanceof CheckboxGroup) {\n        key = tKey('nrg.validation.presence.listBlank');\n      }\n\n      const presenceValidator = new PresenceValidator(\n        binding,\n        { presence: true, key },\n        binding.model,\n      );\n      this.requiredId = form.registerValidator(presenceValidator, this.validatorKey);\n    } else {\n      if (!requiredId) {\n        return;\n      }\n\n      form.unregisterValidator(this.validatorKey, requiredId);\n      this.requiredId = undefined;\n    }\n  }\n\n  setupValidatorModifier = modifier((element: unknown, [required]: [boolean | undefined]) => {\n    runTask(this, () => this.setupValidator(required));\n  });\n\n  <template>\n    {{#if @label}}\n      <label\n        class=\"form-label\"\n        for={{this.fieldId}}\n        {{this.setupValidatorModifier @required}}\n        ...attributes\n      >\n        {{@label}}\n        {{#if @required}}\n          <span class=\"text-danger\">*</span>\n        {{/if}}\n      </label>\n    {{else}}\n      <div class=\"d-none invisible\" {{this.setupValidatorModifier @required}} />\n    {{/if}}\n    {{#let\n      (hash\n        describedBy=this.describedBy\n        disabled=@disabled\n        form=@form\n        id=this.fieldId\n        initBinding=this.initBinding\n        isInvalid=this.hasError\n        isWarning=this.hasWarning\n        required=@required\n        validatorKey=this.validatorKey\n      )\n      as |fieldOptions|\n    }}\n      {{yield\n        (hash\n          Checkbox=(component Checkbox fieldOptions=fieldOptions)\n          CheckboxGroup=(component\n            CheckboxGroup fieldOptions=fieldOptions onInitBinding=this.initBinding\n          )\n          Datetime=(component Datetime fieldOptions=fieldOptions)\n          FileUpload=(component FileUpload fieldOptions=fieldOptions)\n          MultiSelect=(component this.TypedMultiSelect fieldOptions=fieldOptions)\n          NumberInput=(component NumberInput fieldOptions=fieldOptions)\n          PhoneInput=(component PhoneInput fieldOptions=fieldOptions)\n          RadioGroup=(component RadioGroup fieldOptions=fieldOptions)\n          Search=(component this.TypedSearch fieldOptions=fieldOptions)\n          Select=(component this.TypedSelect fieldOptions=fieldOptions)\n          Text=(component Text field=this id=this.textId)\n          TextArea=(component TextArea fieldOptions=fieldOptions)\n          TextInput=(component TextInput fieldOptions=fieldOptions)\n        )\n        fieldOptions\n      }}\n    {{/let}}\n    {{#if this.hasError}}\n      <div class=\"invalid-feedback\" id={{this.messageId}}>\n        {{this.errorMessage}}\n      </div>\n    {{else if this.hasWarning}}\n      <div class=\"warning-feedback\" id={{this.messageId}}>\n        {{this.warningMessage}}\n      </div>\n    {{/if}}\n  </template>\n}\n"],"names":["Text","Component","constructor","owner","args","runTask","field","hasText","registerDestructor","setComponentTemplate","precompileTemplate","strictMode","Field","TypedSearch","Search","TypedSelect","Select","TypedMultiSelect","MultiSelect","g","prototype","tracked","i","crypto","randomUUID","requiredId","setupValidator","isValid","form","didValidate","undefined","isValidFor","validatorKey","hasError","errorMessage","hasWarning","warningMessage","errorFor","warningFor","binding","valuePath","describedBy","push","messageId","textId","join","initBinding","unregisterBinding","unregisterValidator","registerBinding","n","action","required","key","model","CheckboxGroup","tKey","presenceValidator","PresenceValidator","presence","registerValidator","setupValidatorModifier","modifier","element","scope","hash","Checkbox","Datetime","FileUpload","NumberInput","PhoneInput","RadioGroup","TextArea","TextInput"],"mappings":"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"}