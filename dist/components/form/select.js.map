{"version":3,"file":"select.js","sources":["../../../src/components/form/select.gts"],"sourcesContent":["import { fn } from '@ember/helper';\nimport { on } from '@ember/modifier';\nimport { action, get } from '@ember/object';\nimport { service } from '@ember/service';\nimport { isEqual } from '@ember/utils';\nimport { cached, tracked } from '@glimmer/tracking';\nimport { t, tKey } from 'ember-intl';\n// @ts-expect-error Ember keyboard doesn't currently ship a type for the `on-key` modifier\n// https://github.com/adopted-ember-addons/ember-keyboard/issues/464\nimport onKey from 'ember-keyboard/modifiers/on-key';\nimport { runTask } from 'ember-lifeline';\n\nimport Dropdown from '../dropdown.gts';\nimport BoundValue from './bound-value.ts';\nimport onInsert from '../../modifiers/on-insert.ts';\nimport { collapseWhitespace } from '../../utils/string.ts';\n\nimport type { BoundValueSignature, DropdownSignature, Optional } from '../../index.ts';\nimport type { Direction, PopoverVisibility } from '../popover.gts';\nimport type { FieldOptions } from './field.gts';\nimport type IntlService from 'ember-intl/services/intl';\n\ndeclare type SelectOption<T> = {\n  label: string;\n  value: T;\n  raw: T;\n};\n\nfunction isActive<T>(\n  activeIndex: number,\n  optionIndex: number,\n  currentValue: T,\n  option: SelectOption<T>,\n) {\n  const useIndexActive = activeIndex != -1;\n  const isCurrentIndex = optionIndex === activeIndex;\n  const isCurrentValue = isEqual(option.value, currentValue);\n\n  return (useIndexActive && isCurrentIndex) || (!useIndexActive && isCurrentValue);\n}\n\nexport type SelectSignature<T> = BoundValueSignature<\n  {\n    Args: {\n      closeOnSelect?: boolean;\n      defaultText?: string;\n      defaultTextKey?: string;\n      displayPath?: string;\n      loading?: boolean;\n      noOptionsText?: string;\n      noOptionsTextKey?: string;\n      options?: readonly T[];\n      scrollable?: boolean;\n      serializationPath?: string | null;\n      side?: Direction;\n\n      fieldOptions?: FieldOptions;\n    };\n    Blocks: {\n      control?: [PopoverVisibility];\n      display?: [T | undefined];\n      option?: [T | undefined];\n      empty?: [];\n      menu?: DropdownSignature['Blocks']['menu'];\n    };\n    Element: HTMLButtonElement;\n  },\n  T\n>;\n\nexport default class Select<T> extends BoundValue<SelectSignature<T>, T> {\n  declare visibility: PopoverVisibility;\n\n  @tracked\n  menuId = crypto.randomUUID();\n\n  @tracked\n  menuElement: Optional<HTMLElement> = null;\n\n  @tracked\n  activeItem = -1;\n\n  @tracked\n  internalSearchBuffer = '';\n\n  @service\n  declare intl: IntlService;\n\n  get classList() {\n    const classes = ['dropdown', 'form-control', 'text-start', 'focus-ring'];\n\n    if (this.scrollable) {\n      classes.push('scrollable');\n    }\n\n    if (this.args.fieldOptions?.isInvalid) {\n      classes.push('is-invalid');\n    } else if (this.args.fieldOptions?.isWarning) {\n      classes.push('is-warning');\n    }\n\n    return classes.join(' ');\n  }\n\n  get caretIcon() {\n    return this.isOpen ? 'bi-caret-up-fill' : 'bi-caret-down-fill';\n  }\n\n  get defaultText() {\n    return (\n      this.args.defaultText ??\n      this.intl.t(this.args.defaultTextKey ?? tKey('nrg.select.defaultText'))\n    );\n  }\n\n  get scrollable() {\n    return this.args.scrollable ?? true;\n  }\n\n  get isOpen() {\n    return this.visibility?.isShown && !this.disabled && !!this.internalOptions.length;\n  }\n\n  get selected(): Optional<SelectOption<T>> {\n    const found = this.internalOptions.find((option) => option.value === this.value);\n    return found || null;\n  }\n\n  set selected(option: SelectOption<T>) {\n    this.onChange(option.value);\n  }\n\n  get hasSelected() {\n    return !!this.selected;\n  }\n\n  @cached\n  get internalOptions(): SelectOption<T>[] {\n    if (!this.args.options) {\n      return [];\n    }\n    return this.args.options.map((option) => {\n      if (typeof option !== 'object') {\n        return {\n          raw: option,\n          label: option as string,\n          value: option,\n        };\n      }\n\n      const label = get(option, this.args.displayPath ?? 'label') as string;\n      let value: T = option;\n      // null serializationPath results in value being the raw option\n      if (this.args.serializationPath !== null) {\n        value = get(option, this.args.serializationPath ?? 'value') as T;\n      }\n      return {\n        raw: option,\n        label,\n        value,\n      };\n    });\n  }\n\n  get disabled() {\n    return this.args.fieldOptions?.disabled || this.args.loading;\n  }\n\n  get noOptionsText() {\n    return (\n      this.args.noOptionsText ??\n      this.intl.t(this.args.noOptionsTextKey ?? tKey('nrg.select.noOptions'))\n    );\n  }\n\n  selectItemBySearch() {\n    const searchBuffer = this.internalSearchBuffer;\n    if (searchBuffer.length === 0) {\n      return;\n    }\n\n    const childElements = Array.from(this.menuElement?.querySelectorAll(`li`) ?? []);\n    for (const stringIndex in childElements) {\n      const index = parseInt(stringIndex);\n      const element = childElements[index];\n      if (!element) {\n        continue;\n      }\n      const text = element.textContent?.toLowerCase() ?? '';\n      const splitText = collapseWhitespace(text).split(' ') ?? [];\n      for (const text of splitText) {\n        if (text.startsWith(searchBuffer)) {\n          this.activeItem = index;\n          this.scrollActiveItemIntoView();\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  scrollActiveItemIntoView() {\n    if (this.activeItem == -1) {\n      return;\n    }\n    const childElements = Array.from(this.menuElement?.querySelectorAll(`li`) ?? []);\n    const activeElement = childElements[this.activeItem];\n    if (!activeElement) {\n      return;\n    }\n    activeElement.scrollIntoView({ block: 'nearest' });\n  }\n\n  @action\n  onSelectInternal(option: SelectOption<T>, evt?: MouseEvent) {\n    evt?.preventDefault();\n    evt?.stopPropagation();\n\n    this.selected = option;\n  }\n\n  @action\n  onInsert(element: HTMLElement) {\n    this.menuElement = element;\n  }\n\n  @action\n  toggleSelect(evt: MouseEvent) {\n    evt.preventDefault();\n    evt.stopPropagation();\n    if (this.disabled) {\n      return;\n    }\n    if (this.isOpen) {\n      this.onBlur();\n    } else {\n      this.onFocus(evt);\n    }\n  }\n\n  @action\n  onFocus(evt: Event) {\n    const currentlySelectedIndex = this.internalOptions.findIndex(\n      (option) => option.value === this.value,\n    );\n    if (currentlySelectedIndex > -1) {\n      this.activeItem = currentlySelectedIndex;\n      runTask(this, () => {\n        this.scrollActiveItemIntoView();\n      });\n    }\n\n    this.visibility.show(evt);\n  }\n\n  @action\n  onBlur() {\n    this.activeItem = -1;\n    this.internalSearchBuffer = '';\n    this.visibility.hide();\n  }\n\n  @action\n  onKeyboardInput(evt: KeyboardEvent) {\n    if (!this.visibility.isShown) {\n      return;\n    }\n    const key = evt.key.toLowerCase();\n    const isSingleChar = key.length === 1;\n    const isLetter = 'a' <= key && key <= 'z';\n    const isNumber = '0' <= key && key <= '9';\n    const isAlphaNumeric = (isLetter || isNumber) && isSingleChar;\n    if (!isAlphaNumeric) {\n      return;\n    }\n    evt.preventDefault();\n    evt.stopPropagation();\n    this.internalSearchBuffer += key;\n    const foundItem = this.selectItemBySearch();\n    if (!foundItem && this.internalSearchBuffer.length > 1) {\n      this.internalSearchBuffer = key;\n      this.selectItemBySearch();\n    }\n  }\n\n  @action\n  moveUp(evt: KeyboardEvent) {\n    evt.preventDefault();\n    evt.stopPropagation();\n    if (!this.visibility.isShown) {\n      return;\n    }\n    this.internalSearchBuffer = '';\n    if (this.activeItem > 0) {\n      this.activeItem--;\n      this.scrollActiveItemIntoView();\n    }\n  }\n\n  @action\n  moveDown(evt: KeyboardEvent) {\n    evt.preventDefault();\n    evt.stopPropagation();\n    if (!this.visibility.isShown) {\n      return;\n    }\n    this.internalSearchBuffer = '';\n    if (this.activeItem < this.internalOptions.length - 1) {\n      this.activeItem++;\n      this.scrollActiveItemIntoView();\n    }\n  }\n\n  @action\n  enterKeyHandler(evt: KeyboardEvent) {\n    evt?.preventDefault();\n    evt?.stopPropagation();\n    this.internalSearchBuffer = '';\n    if (!this.visibility.isShown) {\n      this.onFocus(evt);\n      return;\n    }\n\n    const optionsLength = this.internalOptions.length;\n    const validRange = this.activeItem >= 0 && this.activeItem < optionsLength;\n    if (validRange) {\n      const option = this.internalOptions[this.activeItem];\n      if (option != undefined) {\n        this.onSelectInternal(option);\n        return;\n      }\n    }\n    this.onBlur();\n  }\n\n  @action\n  exitKeyHandler(evt?: KeyboardEvent) {\n    evt?.preventDefault();\n    evt?.stopPropagation();\n    if (!this.visibility.isShown) {\n      return;\n    }\n    this.internalSearchBuffer = '';\n    this.onBlur();\n  }\n\n  @action\n  saveVisibility(visibility: PopoverVisibility) {\n    this.visibility = visibility;\n  }\n\n  <template>\n    <Dropdown\n      @closeOnSelect={{@closeOnSelect}}\n      @fullWidth={{true}}\n      @scrollable={{this.scrollable}}\n      @side={{@side}}\n      @onHide={{this.onBlur}}\n      {{on \"blur\" this.onBlur}}\n      {{onInsert this.onInsert}}\n    >\n      <:control as |visibility|>\n        {{#if (has-block-params \"control\")}}\n          {{yield visibility to=\"control\"}}\n        {{else}}\n          <button\n            class={{this.classList}}\n            id={{@fieldOptions.id}}\n            type=\"button\"\n            role=\"combobox\"\n            disabled={{this.disabled}}\n            aria-controls={{this.menuId}}\n            aria-describedby={{@fieldOptions.describedBy}}\n            aria-expanded={{visibility.isShown}}\n            aria-haspopup=\"listbox\"\n            {{on \"click\" this.toggleSelect}}\n            {{on \"keydown\" this.onKeyboardInput}}\n            {{onInsert (fn this.saveVisibility visibility)}}\n            {{onKey \"ArrowUp\" this.moveUp onlyWhenFocused=true}}\n            {{onKey \"ArrowDown\" this.moveDown onlyWhenFocused=true}}\n            {{onKey \"Enter\" this.enterKeyHandler onlyWhenFocused=true}}\n            {{onKey \"Space\" this.enterKeyHandler onlyWhenFocused=true}}\n            {{onKey \"Tab\" this.exitKeyHandler onlyWhenFocused=true}}\n            {{onKey \"Escape\" this.exitKeyHandler onlyWhenFocused=true}}\n            ...attributes\n          >\n            <span class=\"selected-display\">\n              {{#if this.hasSelected}}\n                {{#if (has-block \"display\")}}\n                  {{yield this.selected.raw to=\"display\"}}\n                {{else if (has-block \"option\")}}\n                  {{yield this.selected.raw to=\"option\"}}\n                {{else}}\n                  {{this.selected.label}}\n                {{/if}}\n              {{else}}\n                {{#if (has-block \"empty\")}}\n                  {{yield to=\"empty\"}}\n                {{else}}\n                  {{this.defaultText}}\n                {{/if}}\n              {{/if}}\n            </span>\n            {{! @glint-expect-error - If there are no block params, we don't need to yield anything to the block }}\n            {{yield to=\"control\"}}\n            {{#if @loading}}\n              <span\n                class=\"spinner-border spinner-border-sm float-end m-1\"\n                aria-hidden=\"true\"\n              ></span>\n              <span class=\"visually-hidden\" role=\"status\">\n                {{t \"nrg.base.loading\"}}\n              </span>\n            {{else}}\n              <i class=\"bi {{this.caretIcon}} float-end mx-1\" />\n            {{/if}}\n          </button>\n        {{/if}}\n      </:control>\n      <:menu as |Menu|>\n        {{#each this.internalOptions as |option i|}}\n          {{#let (isActive this.activeItem i this.value option) as |isActive|}}\n            <Menu.Item\n              aria-selected={{isActive}}\n              class={{if isActive \"active\"}}\n              @onSelect={{fn this.onSelectInternal option}}\n            >\n              {{#if (has-block \"option\")}}\n                {{yield option.raw to=\"option\"}}\n              {{else}}\n                {{option.label}}\n              {{/if}}\n            </Menu.Item>\n          {{/let}}\n        {{else}}\n          <Menu.Item aria-disabled={{true}} @disabled={{true}}>\n            {{this.noOptionsText}}\n          </Menu.Item>\n        {{/each}}\n        {{yield Menu to=\"menu\"}}\n      </:menu>\n    </Dropdown>\n  </template>\n}\n"],"names":["isActive","activeIndex","optionIndex","currentValue","option","useIndexActive","isCurrentIndex","isCurrentValue","isEqual","value","Select","BoundValue","g","prototype","tracked","crypto","randomUUID","i","service","classList","classes","scrollable","push","args","fieldOptions","isInvalid","isWarning","join","caretIcon","isOpen","defaultText","intl","t","defaultTextKey","tKey","visibility","isShown","disabled","internalOptions","length","selected","found","find","onChange","hasSelected","options","map","raw","label","get","displayPath","serializationPath","n","cached","loading","noOptionsText","noOptionsTextKey","selectItemBySearch","searchBuffer","internalSearchBuffer","childElements","Array","from","menuElement","querySelectorAll","stringIndex","index","parseInt","element","text","textContent","toLowerCase","splitText","collapseWhitespace","split","startsWith","activeItem","scrollActiveItemIntoView","activeElement","scrollIntoView","block","onSelectInternal","evt","preventDefault","stopPropagation","action","onInsert","toggleSelect","onBlur","onFocus","currentlySelectedIndex","findIndex","runTask","show","hide","onKeyboardInput","key","isSingleChar","isLetter","isNumber","isAlphaNumeric","foundItem","moveUp","moveDown","enterKeyHandler","optionsLength","validRange","undefined","exitKeyHandler","saveVisibility","setComponentTemplate","precompileTemplate","strictMode","scope","Dropdown","on","fn","onKey"],"mappings":"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"}