{"version":3,"file":"modal.js","sources":["../../src/components/modal.gts"],"sourcesContent":["import { registerDestructor } from '@ember/destroyable';\nimport { on } from '@ember/modifier';\nimport { action } from '@ember/object';\nimport { service } from '@ember/service';\nimport Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nimport { cssTransition } from 'ember-css-transitions';\nimport { t } from 'ember-intl';\nimport { modifier } from 'ember-modifier';\n\nimport type ModalService from '../services/modal.ts';\nimport type Owner from '@ember/owner';\n\nexport interface ModalSignature {\n  Element: HTMLDialogElement;\n  Args: {\n    isOpen?: boolean;\n    dismissible?: boolean;\n    subtle?: boolean;\n    position?: 'center' | 'left' | 'right';\n\n    onDismiss?: () => void;\n  };\n  Blocks: {\n    header?: [];\n    default?: [];\n    footer?: [];\n  };\n}\n\nexport default class Modal extends Component<ModalSignature> {\n  @service('modal')\n  declare modalService: ModalService;\n\n  @tracked\n  dialogElement!: HTMLDialogElement;\n\n  @tracked\n  dialogId = '_' + crypto.randomUUID();\n\n  constructor(owner: Owner, args: ModalSignature['Args']) {\n    super(owner, args);\n\n    registerDestructor(this, () => {\n      if (this.args.isOpen) {\n        this.closeModal();\n      }\n    });\n  }\n\n  get isActive() {\n    return this.dialogId === this.modalService.activeModal;\n  }\n\n  get position() {\n    return this.args.position ?? 'center';\n  }\n\n  get classList() {\n    const classes = ['border-0', 'rounded-3', this.position];\n\n    if (!this.isActive) {\n      classes.push('inactive');\n    }\n\n    if (this.args.subtle) {\n      classes.push('subtle');\n    }\n\n    return classes.join(' ');\n  }\n\n  get isDismissible() {\n    return this.args.dismissible ?? true;\n  }\n\n  @action\n  onDismiss(evt?: Event) {\n    evt?.preventDefault();\n    evt?.stopPropagation();\n\n    if (!this.isDismissible) {\n      return;\n    }\n\n    this.args.onDismiss?.();\n  }\n\n  @action\n  onClose() {\n    if (!this.args.isOpen) {\n      return;\n    }\n\n    // This function is a callback for the dialog's \"close\" event,\n    // which cannot be canceled. Since a user pressing \"Escape\" or clicking\n    // outside the dialog will trigger this event, we need to re-open\n    // the dialog in case it is not dismissible.\n    // If it is dismissible, we'll close it immediately after.\n    this.openModal();\n\n    if (this.isDismissible) {\n      this.onDismiss();\n    }\n  }\n\n  onInsert = modifier((element: HTMLDialogElement) => {\n    this.dialogElement = element;\n  });\n\n  onUpdate = modifier(() => {\n    if (this.args.isOpen) {\n      this.openModal();\n    } else {\n      this.closeModal();\n    }\n  });\n\n  @action\n  openModal() {\n    this.dialogElement.showModal();\n    this.modalService.openModal(this.dialogId);\n  }\n\n  @action\n  closeModal() {\n    this.dialogElement.close();\n    this.modalService.closeModal(this.dialogId);\n  }\n\n  <template>\n    <dialog\n      class={{this.classList}}\n      id={{this.dialogId}}\n      {{on \"cancel\" this.onDismiss}}\n      {{on \"close\" this.onClose}}\n      {{this.onInsert}}\n      {{this.onUpdate @isOpen}}\n      ...attributes\n    >\n      {{#if @isOpen}}\n        <div class=\"modal-content\" {{cssTransition \"modal\" didTransitionOut=this.closeModal}}>\n          {{#if this.isDismissible}}\n            <button\n              aria-label={{t \"nrg.base.close\"}}\n              class=\"btn-close\"\n              type=\"button\"\n              {{on \"click\" this.onDismiss}}\n            ></button>\n          {{/if}}\n          {{#if (has-block \"header\")}}\n            <div class=\"modal-header\">\n              <h5 class=\"modal-title\">\n                {{yield to=\"header\"}}\n              </h5>\n            </div>\n          {{/if}}\n          <div class=\"modal-body\">\n            {{yield}}\n          </div>\n          {{#if (has-block \"footer\")}}\n            <div class=\"modal-footer\">\n              {{yield to=\"footer\"}}\n            </div>\n          {{/if}}\n        </div>\n      {{/if}}\n    </dialog>\n  </template>\n}\n"],"names":["Modal","Component","g","prototype","service","i","tracked","crypto","randomUUID","constructor","owner","args","registerDestructor","isOpen","closeModal","isActive","dialogId","modalService","activeModal","position","classList","classes","push","subtle","join","isDismissible","dismissible","onDismiss","evt","preventDefault","stopPropagation","n","action","onClose","openModal","onInsert","modifier","element","dialogElement","onUpdate","showModal","close","setComponentTemplate","precompileTemplate","strictMode","scope","on","cssTransition","t"],"mappings":"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"}