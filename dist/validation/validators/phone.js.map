{"version":3,"file":"phone.js","sources":["../../../src/validation/validators/phone.ts"],"sourcesContent":["import { isEmpty, isNone } from '@ember/utils';\nimport { tKey } from 'ember-intl';\n\nimport BaseValidator from './base.ts';\nimport { getAreaCode, getCountryCode, getExchangeCode } from '../../utils/phone.ts';\n\nimport type { BaseOptions, ValidateFnResponse } from '../types';\n\nexport type PhoneOptions = {\n  /**\n   * If `true`, the value can be an empty string, null, or undefined.\n   */\n  allowBlank?: boolean;\n  /**\n   * If `allow`, the number may contain an area code.\n   * If `disallow`, the number must not contain an area code.\n   * If `require`, the number must contain an area code.\n   * @default 'allow'\n   */\n  areaCode?: 'allow' | 'disallow' | 'require';\n  /**\n   * If `allow`, the number may contain a country code.\n   * If `disallow`, the number must not contain a country code.\n   * If `require`, the number must contain a country code.\n   * @default 'allow'\n   */\n  countryCode?: 'allow' | 'disallow' | 'require';\n  /**\n   * If provided, the area code of the number must not match any of the provided area codes.\n   */\n  invalidAreaCodes?: string[];\n  /**\n   * If provided, the country code of the number must not match any of the provided country codes.\n   */\n  invalidCountryCodes?: string[];\n  /**\n   * If provided, the exchange code of the number must not match any of the provided exchange codes.\n   */\n  invalidExchangeCodes?: string[];\n  /**\n   * If provided, the area code of the number must match one of the provided area codes.\n   */\n  validAreaCodes?: string[];\n  /**\n   * If provided, the country code of the number must match one of the provided country codes.\n   */\n  validCountryCodes?: string[];\n  /**\n   * If provided, the exchange code of the number must match one of the provided exchange codes.\n   */\n  validExchangeCodes?: string[];\n} & BaseOptions;\n\nexport default class PhoneValidator<\n  Context extends object = Record<string, unknown>,\n> extends BaseValidator<string | null | undefined, Context, PhoneOptions> {\n  defaultOptions = {\n    areaCode: 'allow' as const,\n    countryCode: 'allow' as const,\n  };\n\n  validate(value: string | null | undefined, options: PhoneOptions): ValidateFnResponse {\n    const { allowBlank } = options;\n\n    const key = tKey('nrg.validation.phone.invalid');\n\n    if (isEmpty(value) || isNone(value)) {\n      if (allowBlank) {\n        return true;\n      }\n      return {\n        key,\n        value,\n      };\n    }\n\n    let result = this.checkCountryCode(value, options);\n    if (result !== true) {\n      return result;\n    }\n\n    result = this.checkAreaCode(value, options);\n    if (result !== true) {\n      return result;\n    }\n\n    result = this.checkExchangeCode(value, options);\n    if (result !== true) {\n      return result;\n    }\n\n    if (value) {\n      const length = value.length;\n\n      if (length < 7 || length > 13) {\n        return {\n          key,\n          value,\n        };\n      }\n    }\n\n    return result;\n  }\n\n  checkCountryCode(value: string, options: PhoneOptions): ValidateFnResponse {\n    const { countryCode, validCountryCodes, invalidCountryCodes } = options;\n    const cc = getCountryCode(value);\n\n    if (cc && countryCode === 'disallow') {\n      return {\n        key: tKey('nrg.validation.phone.countryCode.notAllowed'),\n        value,\n      };\n    }\n\n    if (!cc && countryCode === 'require') {\n      return {\n        key: tKey('nrg.validation.phone.countryCode.required'),\n        value,\n      };\n    }\n\n    if (cc && validCountryCodes && !validCountryCodes.includes(cc)) {\n      return {\n        key: tKey('nrg.validation.phone.countryCode.valid'),\n        value,\n        countryCodes: this.listToString(validCountryCodes),\n      };\n    }\n\n    if (cc && invalidCountryCodes?.includes(cc)) {\n      return {\n        key: tKey('nrg.validation.phone.countryCode.invalid'),\n        value,\n        countryCodes: this.listToString(invalidCountryCodes),\n      };\n    }\n\n    return true;\n  }\n\n  checkAreaCode(value: string, options: PhoneOptions): ValidateFnResponse {\n    const { areaCode, validAreaCodes, invalidAreaCodes } = options;\n\n    const ac = getAreaCode(value);\n\n    if (ac && areaCode === 'disallow') {\n      return {\n        key: tKey('nrg.validation.phone.areaCode.notAllowed'),\n        value,\n      };\n    } else if (!ac && areaCode === 'require') {\n      return {\n        key: tKey('nrg.validation.phone.areaCode.required'),\n        value,\n      };\n    }\n\n    if (ac && validAreaCodes && !validAreaCodes.includes(ac)) {\n      return {\n        key: tKey('nrg.validation.phone.areaCode.valid'),\n        value,\n        areaCodes: this.listToString(validAreaCodes),\n      };\n    }\n\n    if (ac && invalidAreaCodes?.includes(ac)) {\n      return {\n        key: tKey('nrg.validation.phone.areaCode.invalid'),\n        value,\n        areaCodes: this.listToString(invalidAreaCodes),\n      };\n    }\n\n    return true;\n  }\n\n  checkExchangeCode(value: string, options: PhoneOptions): ValidateFnResponse {\n    const { validExchangeCodes, invalidExchangeCodes } = options;\n    let key;\n    let exchangeCodes;\n\n    if (!validExchangeCodes && !invalidExchangeCodes) {\n      return true;\n    }\n\n    const ec = getExchangeCode(value);\n    if (validExchangeCodes && !validExchangeCodes.includes(ec)) {\n      key = tKey('nrg.validation.phone.exchangeCode.valid');\n      exchangeCodes = this.listToString(validExchangeCodes);\n    }\n\n    if (invalidExchangeCodes?.includes(ec)) {\n      key = tKey('nrg.validation.phone.exchangeCode.invalid');\n      exchangeCodes = this.listToString(invalidExchangeCodes);\n    }\n\n    if (key) {\n      return {\n        key,\n        value,\n        exchangeCodes,\n      };\n    }\n\n    return true;\n  }\n\n  listToString(value: string[]): string {\n    return this.intl.formatList(value);\n  }\n}\n"],"names":["PhoneValidator","BaseValidator","defaultOptions","areaCode","countryCode","validate","value","options","allowBlank","key","tKey","isEmpty","isNone","result","checkCountryCode","checkAreaCode","checkExchangeCode","length","validCountryCodes","invalidCountryCodes","cc","getCountryCode","includes","countryCodes","listToString","validAreaCodes","invalidAreaCodes","ac","getAreaCode","areaCodes","validExchangeCodes","invalidExchangeCodes","exchangeCodes","ec","getExchangeCode","intl","formatList"],"mappings":"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"}