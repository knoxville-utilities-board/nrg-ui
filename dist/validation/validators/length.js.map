{"version":3,"file":"length.js","sources":["../../../src/validation/validators/length.ts"],"sourcesContent":["import { assert } from '@ember/debug';\nimport { isEmpty, isNone } from '@ember/utils';\nimport { tKey } from 'ember-intl';\n\nimport BaseValidator from './base.ts';\n\nimport type { Binding } from '../../index.ts';\nimport type { BaseOptions, Computable, ValidateFnResponse } from '../types';\n\nexport type LengthOptions = {\n  /**\n   * If `true`, the value can be an empty string or array.\n   */\n  allowBlank?: boolean;\n  /**\n   * If `true`, the value can be `null` or `undefined`.\n   */\n  allowNone?: boolean;\n  /**\n   * If set, the length must be greater than `between[0]` and\n   * less than `between[1]`.\n   */\n  between?: [number, number];\n  /**\n   * If set, the length must equal this value.\n   */\n  is?: number;\n  /**\n   * If set, the length cannot be greater than or\n   * equal to this.\n   */\n  max?: number;\n  /**\n   * If set, the length cannot be less than or\n   * equal to this.\n   */\n  min?: number;\n} & BaseOptions;\n\nexport default class LengthValidator<\n  T extends ArrayLike<unknown>,\n  Context extends object = Record<string, unknown>,\n> extends BaseValidator<T, Context, LengthOptions> {\n  defaultOptions = {\n    allowNone: true,\n    presence: true,\n  };\n\n  constructor(binding: Binding, options: Computable<Context, LengthOptions>, context?: Context) {\n    super(binding, options, context);\n\n    if (\n      isNone(options.is) &&\n      isNone(options.min) &&\n      isNone(options.max) &&\n      isNone(options.between)\n    ) {\n      assert('LengthValidator requires either `is`, `min`, `max`, or `between` to be provided');\n    }\n  }\n\n  validate(value: T, options: LengthOptions): ValidateFnResponse {\n    const { allowBlank, allowNone, between, is, max, min } = options;\n\n    if (isNone(value)) {\n      if (allowNone) {\n        return true;\n      }\n\n      return {\n        key: tKey('nrg.validation.length.invalid'),\n        value,\n      };\n    }\n\n    if (allowBlank && isEmpty(value)) {\n      return true;\n    }\n\n    const type = typeof value === 'string' ? 'string' : 'array';\n    const length = value.length;\n\n    if (!isNone(is) && length !== is) {\n      return {\n        key: `nrg.validation.length.${type}.wrongLength`,\n        is,\n        length,\n        value: this.toString(value),\n      };\n    }\n\n    if (!isNone(min) && length < min) {\n      return {\n        key: `nrg.validation.length.${type}.tooShort`,\n        min,\n        length,\n        value: this.toString(value),\n      };\n    }\n\n    if (!isNone(max) && length > max) {\n      return {\n        key: `nrg.validation.length.${type}.tooLong`,\n        max,\n        length,\n        value: this.toString(value),\n      };\n    }\n\n    if (!isNone(between) && (length < between[0] || length > between[1])) {\n      return {\n        key: `nrg.validation.length.${type}.between`,\n        min: between[0],\n        max: between[1],\n        length,\n        value: this.toString(value),\n      };\n    }\n\n    return true;\n  }\n\n  toString(value: T): string {\n    if (typeof value === 'string') {\n      return value;\n    }\n    if (Array.isArray(value)) {\n      return this.intl.formatList(value.map(String));\n    }\n    const values = Array.from(value).map(String);\n\n    return this.intl.formatList(values);\n  }\n}\n"],"names":["LengthValidator","BaseValidator","defaultOptions","allowNone","presence","constructor","binding","options","context","isNone","is","min","max","between","assert","validate","value","allowBlank","key","tKey","isEmpty","type","length","toString","Array","isArray","intl","formatList","map","String","values","from"],"mappings":"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"}