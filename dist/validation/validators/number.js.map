{"version":3,"file":"number.js","sources":["../../../src/validation/validators/number.ts"],"sourcesContent":["import { isEmpty, isNone } from '@ember/utils';\nimport { tKey } from 'ember-intl';\n\nimport BaseValidator from './base.ts';\n\nimport type { BaseOptions, ValidateFnResponse } from '../types';\n\nexport type NumberOptions = {\n  /**\n   * When true, `null` and empty strings are valid\n   * @default false\n   */\n  allowBlank?: boolean;\n  /**\n   * When true, `null` and `undefined` are valid\n   * @default true\n   */\n  allowNone?: boolean;\n  /**\n   * When true, strings will be parsed as numbers\n   * @default false\n   */\n  allowString?: boolean;\n  /**\n   * When true, only integers are valid\n   * @default false\n   */\n  integer?: boolean;\n  /**\n   * When true, only positive numbers are valid\n   * @default false\n   */\n  positive?: boolean;\n  /**\n   * When true, only negative numbers are valid\n   * @default false\n   */\n  negative?: boolean;\n  /**\n   * When true, only even numbers are valid\n   * @default false\n   */\n  even?: boolean;\n  /**\n   * When true, only odd numbers are valid\n   * @default false\n   */\n  odd?: boolean;\n  /**\n   * When set, the number must be a multiple of this value\n   */\n  multipleOf?: number;\n  /**\n   * When set, the number must be exactly this value\n   */\n  is?: number;\n  /**\n   * When set, the number of decimal places must be less than or equal to this value\n   */\n  maxPrecision?: number;\n} & BaseOptions;\n\ndeclare type NumberLike = number | string | null | undefined;\n\nexport default class NumberValidator<\n  Context extends object = Record<string, unknown>,\n> extends BaseValidator<NumberLike, Context, NumberOptions> {\n  defaultOptions = {\n    allowNone: true,\n  };\n\n  validate(value: NumberLike, options: NumberOptions): ValidateFnResponse {\n    const { allowBlank, allowNone, allowString, integer } = options;\n    const numValue = Number(value);\n\n    if (allowBlank && isEmpty(value)) {\n      return true;\n    }\n\n    if (allowNone && isNone(value)) {\n      return true;\n    }\n\n    if (isEmpty(value)) {\n      return {\n        key: tKey('nrg.validation.number.notANumber'),\n      };\n    }\n\n    if (typeof value === 'string' && !allowString) {\n      return {\n        key: tKey('nrg.validation.number.notANumber'),\n      };\n    }\n\n    if (integer && !Number.isInteger(numValue)) {\n      return {\n        key: tKey('nrg.validation.number.integer'),\n      };\n    }\n\n    return this.handleOptions(numValue, options);\n  }\n\n  handleOptions(value: number, options: NumberOptions): ValidateFnResponse {\n    const { positive, negative, even, odd, is } = options;\n\n    if (positive && !isPositive(value)) {\n      return {\n        key: tKey('nrg.validation.number.positive'),\n      };\n    }\n\n    if (negative && !isNegative(value)) {\n      return {\n        key: tKey('nrg.validation.number.negative'),\n      };\n    }\n\n    if (even && !isEven(value)) {\n      return {\n        key: tKey('nrg.validation.number.even'),\n      };\n    }\n\n    if (odd && !isOdd(value)) {\n      return {\n        key: tKey('nrg.validation.number.odd'),\n      };\n    }\n\n    const multipleOf = options['multipleOf'];\n    if (multipleOf && !isMultipleOf(value, multipleOf)) {\n      return {\n        key: tKey('nrg.validation.number.multipleOf'),\n        multipleOf,\n      };\n    }\n\n    const isValue = is;\n    if (isValue !== undefined && value !== isValue) {\n      return {\n        key: tKey('nrg.validation.number.isValue'),\n        isValue,\n      };\n    }\n\n    const maxPrecision = options['maxPrecision'];\n    if (maxPrecision !== undefined && !hasMaxPrecision(value, maxPrecision)) {\n      return {\n        key: tKey('nrg.validation.number.precision'),\n        precision: maxPrecision,\n      };\n    }\n\n    return true;\n  }\n}\n\nconst isPositive = (value: number) => value > 0;\nconst isNegative = (value: number) => value < 0;\nconst isEven = (value: number) => value % 2 === 0;\nconst isOdd = (value: number) => value % 2 !== 0;\nconst isMultipleOf = (value: number, multiple: number) => value % multiple === 0;\n\nconst hasMaxPrecision = (value: number, maxPrecision: number): boolean => {\n  const [, decimal] = value.toString().split('.');\n  return decimal ? decimal.length <= maxPrecision : true;\n};\n"],"names":["NumberValidator","BaseValidator","defaultOptions","allowNone","validate","value","options","allowBlank","allowString","integer","numValue","Number","isEmpty","isNone","key","tKey","isInteger","handleOptions","positive","negative","even","odd","is","isPositive","isNegative","isEven","isOdd","multipleOf","isMultipleOf","isValue","undefined","maxPrecision","hasMaxPrecision","precision","multiple","decimal","toString","split","length"],"mappings":"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"}