{"version":3,"file":"context-menu.js","sources":["../../src/services/context-menu.ts"],"sourcesContent":["import { assert } from '@ember/debug';\nimport Service from '@ember/service';\nimport { TrackedMap } from 'tracked-built-ins';\n\nimport type { DropdownSignature } from '../components/dropdown.gts';\n\nexport type Dropdown = DropdownSignature['Blocks']['menu'][0];\n\nexport interface Menu {\n  id: string;\n  top: HTMLDivElement;\n  bottom: HTMLDivElement;\n  dropdown: Dropdown;\n}\n\nexport default class ContextMenuService extends Service {\n  menus = new TrackedMap<string, Menu>();\n\n  menu(id: string) {\n    return this.menus.get(id);\n  }\n\n  async register(\n    id: string,\n    { top, bottom, dropdown }: { top: HTMLDivElement; bottom: HTMLDivElement; dropdown: Dropdown },\n  ) {\n    // This must be disconnected from reactivity to avoid triggering\n    // errors from reading and updating the same property in the same cycle.\n    await Promise.resolve();\n\n    assert('Context menu must have an id.', id);\n    assert(\n      `Context menu with id \"${id}\" already exists. Use a different id or unregister the existing menu.`,\n      !this.menus.has(id),\n    );\n    assert(`Context menu with id \"${id}\" must have a top and bottom element.`, top && bottom);\n    assert(`Context menu with id \"${id}\" must have a dropdown.`, dropdown);\n\n    this.menus.set(id, { id, top, bottom, dropdown });\n  }\n\n  async unregister(id: string) {\n    // This must be disconnected from reactivity to avoid triggering\n    // errors from reading and updating the same property in the same cycle.\n    await Promise.resolve();\n\n    this.menus.delete(id);\n  }\n}\n\ndeclare module '@ember/service' {\n  interface Registry {\n    'context-menu': ContextMenuService;\n  }\n}\n"],"names":["ContextMenuService","Service","menus","TrackedMap","menu","id","get","register","top","bottom","dropdown","Promise","resolve","assert","has","set","unregister","delete"],"mappings":";;;;AAee,MAAMA,kBAAkB,SAASC,OAAO,CAAC;AACtDC,EAAAA,KAAK,GAAG,IAAIC,UAAU,EAAgB;EAEtCC,IAAIA,CAACC,EAAU,EAAE;AACf,IAAA,OAAO,IAAI,CAACH,KAAK,CAACI,GAAG,CAACD,EAAE,CAAC;AAC3B,EAAA;EAEA,MAAME,QAAQA,CACZF,EAAU,EACV;IAAEG,GAAG;IAAEC,MAAM;AAAEC,IAAAA;AAA8E,GAAC,EAC9F;AACA;AACA;AACA,IAAA,MAAMC,OAAO,CAACC,OAAO,EAAE;AAEvBC,IAAAA,MAAM,CAAC,+BAA+B,EAAER,EAAE,CAAC;AAC3CQ,IAAAA,MAAM,CACJ,CAAA,sBAAA,EAAyBR,EAAE,CAAA,qEAAA,CAAuE,EAClG,CAAC,IAAI,CAACH,KAAK,CAACY,GAAG,CAACT,EAAE,CACpB,CAAC;IACDQ,MAAM,CAAC,yBAAyBR,EAAE,CAAA,qCAAA,CAAuC,EAAEG,GAAG,IAAIC,MAAM,CAAC;AACzFI,IAAAA,MAAM,CAAC,CAAA,sBAAA,EAAyBR,EAAE,CAAA,uBAAA,CAAyB,EAAEK,QAAQ,CAAC;AAEtE,IAAA,IAAI,CAACR,KAAK,CAACa,GAAG,CAACV,EAAE,EAAE;MAAEA,EAAE;MAAEG,GAAG;MAAEC,MAAM;AAAEC,MAAAA;AAAS,KAAC,CAAC;AACnD,EAAA;EAEA,MAAMM,UAAUA,CAACX,EAAU,EAAE;AAC3B;AACA;AACA,IAAA,MAAMM,OAAO,CAACC,OAAO,EAAE;AAEvB,IAAA,IAAI,CAACV,KAAK,CAACe,MAAM,CAACZ,EAAE,CAAC;AACvB,EAAA;AACF;;;;"}