{"version":3,"file":"theme.js","sources":["../../src/services/theme.ts"],"sourcesContent":["import { action } from '@ember/object';\nimport Service from '@ember/service';\nimport { tracked } from 'tracked-built-ins';\n\nimport type { IconType, Theme } from '../';\nimport type Owner from '@ember/owner';\n\nexport const themeIcons = {\n  light: 'bi-sun-fill',\n  dark: 'bi-moon-stars-fill',\n  auto: 'bi-circle-half',\n} as const as Record<Theme, IconType>;\n\ntype OwnerLike = {\n  application: {\n    modulePrefix: string;\n  };\n};\n\nexport default class ThemeService extends Service {\n  @tracked\n  declare value: Theme;\n\n  @tracked\n  declare resolvedTheme: Exclude<Theme, 'auto'>;\n\n  declare modulePrefix: string;\n\n  constructor(owner: Owner) {\n    super(owner);\n\n    this.modulePrefix = (owner as unknown as OwnerLike).application.modulePrefix;\n  }\n\n  get storageKey() {\n    return 'nrg.' + (this.modulePrefix ? this.modulePrefix + '.' : '') + 'theme';\n  }\n\n  loaded: boolean = false;\n\n  get icon() {\n    return themeIcons[this.value];\n  }\n\n  load() {\n    if (this.loaded) {\n      return;\n    }\n    const theme = this.loadTheme();\n    this.setTheme(theme);\n    this.loaded = true;\n  }\n\n  loadTheme(): Theme {\n    const theme = localStorage.getItem(this.storageKey) as Theme | null;\n    return theme ?? 'auto';\n  }\n\n  @action\n  setTheme(theme: Theme) {\n    localStorage.setItem(this.storageKey, theme);\n\n    let resolvedTheme = theme;\n    if (theme === 'auto') {\n      resolvedTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n    }\n\n    if (this.resolvedTheme === resolvedTheme && this.value === theme) {\n      return;\n    }\n\n    this.value = theme;\n    this.resolvedTheme = resolvedTheme as Exclude<Theme, 'auto'>;\n\n    document.body.setAttribute('data-bs-theme', resolvedTheme);\n  }\n}\n\ndeclare module '@ember/service' {\n  interface Registry {\n    theme: ThemeService;\n  }\n}\n"],"names":["themeIcons","light","dark","auto","ThemeService","Service","g","prototype","tracked","i","constructor","owner","modulePrefix","application","storageKey","loaded","icon","value","load","theme","loadTheme","setTheme","localStorage","getItem","setItem","resolvedTheme","window","matchMedia","matches","document","body","setAttribute","n","action"],"mappings":";;;;;AAOO,MAAMA,UAAU,GAAG;AACxBC,EAAAA,KAAK,EAAE,aAAa;AACpBC,EAAAA,IAAI,EAAE,oBAAoB;AAC1BC,EAAAA,IAAI,EAAE;AACR;AAQe,MAAMC,YAAY,SAASC,OAAO,CAAC;AAAA,EAAA;IAAAC,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,OAAA,EAAA,CAC/CC,OAAO,CAAA,CAAA;AAAA;EAAA,MAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,OAAA,CAAA,EAAA,MAAA;AAAA,EAAA;IAAAH,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,eAAA,EAAA,CAGPC,OAAO,CAAA,CAAA;AAAA;EAAA,cAAA,IAAAC,CAAA,CAAA,IAAA,EAAA,eAAA,CAAA,EAAA,MAAA;EAKRC,WAAWA,CAACC,KAAY,EAAE;IACxB,KAAK,CAACA,KAAK,CAAC;AAEZ,IAAA,IAAI,CAACC,YAAY,GAAID,KAAK,CAA0BE,WAAW,CAACD,YAAY;AAC9E,EAAA;EAEA,IAAIE,UAAUA,GAAG;AACf,IAAA,OAAO,MAAM,IAAI,IAAI,CAACF,YAAY,GAAG,IAAI,CAACA,YAAY,GAAG,GAAG,GAAG,EAAE,CAAC,GAAG,OAAO;AAC9E,EAAA;AAEAG,EAAAA,MAAM,GAAY,KAAK;EAEvB,IAAIC,IAAIA,GAAG;AACT,IAAA,OAAOhB,UAAU,CAAC,IAAI,CAACiB,KAAK,CAAC;AAC/B,EAAA;AAEAC,EAAAA,IAAIA,GAAG;IACL,IAAI,IAAI,CAACH,MAAM,EAAE;AACf,MAAA;AACF,IAAA;AACA,IAAA,MAAMI,KAAK,GAAG,IAAI,CAACC,SAAS,EAAE;AAC9B,IAAA,IAAI,CAACC,QAAQ,CAACF,KAAK,CAAC;IACpB,IAAI,CAACJ,MAAM,GAAG,IAAI;AACpB,EAAA;AAEAK,EAAAA,SAASA,GAAU;IACjB,MAAMD,KAAK,GAAGG,YAAY,CAACC,OAAO,CAAC,IAAI,CAACT,UAAU,CAAiB;IACnE,OAAOK,KAAK,IAAI,MAAM;AACxB,EAAA;EAGAE,QAAQA,CAACF,KAAY,EAAE;IACrBG,YAAY,CAACE,OAAO,CAAC,IAAI,CAACV,UAAU,EAAEK,KAAK,CAAC;IAE5C,IAAIM,aAAa,GAAGN,KAAK;IACzB,IAAIA,KAAK,KAAK,MAAM,EAAE;AACpBM,MAAAA,aAAa,GAAGC,MAAM,CAACC,UAAU,CAAC,8BAA8B,CAAC,CAACC,OAAO,GAAG,MAAM,GAAG,OAAO;AAC9F,IAAA;IAEA,IAAI,IAAI,CAACH,aAAa,KAAKA,aAAa,IAAI,IAAI,CAACR,KAAK,KAAKE,KAAK,EAAE;AAChE,MAAA;AACF,IAAA;IAEA,IAAI,CAACF,KAAK,GAAGE,KAAK;IAClB,IAAI,CAACM,aAAa,GAAGA,aAAuC;IAE5DI,QAAQ,CAACC,IAAI,CAACC,YAAY,CAAC,eAAe,EAAEN,aAAa,CAAC;AAC5D,EAAA;AAAC,EAAA;IAAAO,CAAA,CAAA,IAAA,CAAAzB,SAAA,EAAA,UAAA,EAAA,CAjBA0B,MAAM,CAAA,CAAA;AAAA;AAkBT;;;;"}