{"version":3,"file":"toast.js","sources":["../../src/services/toast.ts"],"sourcesContent":["import { action } from '@ember/object';\nimport Service from '@ember/service';\nimport { isBlank } from '@ember/utils';\nimport { isTesting, macroCondition } from '@embroider/macros';\nimport { tracked } from '@glimmer/tracking';\nimport { cancelTask, runTask } from 'ember-lifeline';\nimport { TrackedArray } from 'tracked-built-ins';\n\nimport type { Timer } from '@ember/runloop';\n\nexport type ToastOptions = {\n  message: string;\n  type: 'success' | 'info' | 'warning' | 'danger';\n  sticky?: boolean;\n  timeout?: number;\n  timeoutReference?: Timer;\n};\n\nexport default class ToastService extends Service {\n  @tracked\n  queue: Array<ToastOptions> = new TrackedArray();\n\n  @action\n  info(message: string, options?: Partial<ToastOptions>) {\n    this.add({\n      ...options,\n      message,\n      type: 'info',\n    });\n  }\n\n  @action\n  success(message: string, options?: Partial<ToastOptions>) {\n    this.add({\n      ...options,\n      message,\n      type: 'success',\n    });\n  }\n\n  @action\n  warning(message: string, options?: Partial<ToastOptions>) {\n    this.add({\n      ...options,\n      message,\n      type: 'warning',\n    });\n  }\n\n  @action\n  danger(message: string, options?: Partial<ToastOptions>) {\n    this.add({\n      ...options,\n      message,\n      type: 'danger',\n    });\n  }\n\n  @action\n  add(options: ToastOptions) {\n    if (isBlank(options.timeout) && options.sticky !== true) {\n      options.timeout = 5000;\n    }\n\n    if (macroCondition(isTesting())) {\n      options.timeout = 0;\n    }\n\n    if (options.timeout) {\n      options.timeoutReference = runTask(\n        this,\n        () => {\n          const index = this.queue.indexOf(options);\n          if (index !== -1) {\n            this.queue.splice(index, 1);\n          }\n        },\n        options.timeout,\n      ) as Timer;\n    }\n    this.queue.push(options);\n  }\n\n  @action\n  remove(message: ToastOptions) {\n    if (message.timeoutReference) {\n      cancelTask(this, message.timeoutReference);\n    }\n    const index = this.queue.indexOf(message);\n    if (index !== -1) {\n      this.queue.splice(index, 1);\n    }\n  }\n\n  @action\n  clear() {\n    this.queue.splice(0, this.queue.length);\n  }\n}\n\ndeclare module '@ember/service' {\n  interface Registry {\n    toast: ToastService;\n  }\n}\n"],"names":["ToastService","Service","g","prototype","tracked","TrackedArray","i","info","message","options","add","type","n","action","success","warning","danger","isBlank","timeout","sticky","macroCondition","isTesting","timeoutReference","runTask","index","queue","indexOf","splice","push","remove","cancelTask","clear","length"],"mappings":"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"}