{"version":3,"file":"media.js","sources":["../../src/services/media.ts"],"sourcesContent":["import { assert } from '@ember/debug';\nimport Service from '@ember/service';\nimport { getOwnConfig, isTesting as isTestingMacro, macroCondition } from '@embroider/macros';\nimport { tracked } from '@glimmer/tracking';\nimport { runTask } from 'ember-lifeline';\nimport { TrackedSet } from 'tracked-built-ins';\n\nimport type Owner from '@ember/owner';\n\nconst isTesting = macroCondition(isTestingMacro()) ? true : false;\n\ntype Fn = () => unknown | Promise<unknown>;\ntype Callbacks = {\n  mediaChanged: Set<Fn>;\n};\ntype Matcher = {\n  matches: boolean;\n  media: string;\n};\n\nexport const defaultBreakpoints = Object.freeze({\n  xsmall: '(min-width: 0px) and (max-width: 575px)',\n  small: '(min-width: 576px) and (max-width: 767px)',\n  medium: '(min-width: 768px) and (max-width: 991px)',\n  large: '(min-width: 992px) and (max-width: 1199px)',\n  xlarge: '(min-width: 1200px) and (max-width: 1399px)',\n  xxlarge: '(min-width: 1400px)',\n});\n\nexport default class MediaService extends Service {\n  _mockedBreakpoint = 'desktop';\n\n  @tracked\n  _matches = new TrackedSet<string>();\n\n  @tracked\n  mocked = isTesting;\n\n  callbacks: Callbacks = {\n    mediaChanged: new Set(),\n  };\n\n  breakpoints = {\n    ...defaultBreakpoints,\n    ...getOwnConfig()?.breakpoints,\n  };\n\n  constructor(owner: Owner) {\n    super(owner);\n\n    for (const [name, query] of Object.entries(this.breakpoints)) {\n      this.match(name, query);\n    }\n  }\n\n  get matches(): Set<string> {\n    if (isTesting && this.mocked) {\n      return new TrackedSet([this._mockedBreakpoint]);\n    }\n\n    return this._matches;\n  }\n\n  set matches(value: Iterable<string>) {\n    this._matches = new TrackedSet(value);\n  }\n\n  get isXSmall(): boolean {\n    return this.matches.has('xsmall');\n  }\n\n  get isSmall(): boolean {\n    return this.matches.has('small');\n  }\n\n  get isMedium(): boolean {\n    return this.matches.has('medium');\n  }\n\n  get isLarge(): boolean {\n    return this.matches.has('large');\n  }\n\n  get isXLarge(): boolean {\n    return this.matches.has('xlarge');\n  }\n\n  get isXXLarge(): boolean {\n    return this.matches.has('xxlarge');\n  }\n\n  #getCallbackList(name: keyof Callbacks) {\n    const callbackList = this.callbacks[name];\n\n    assert(`Callback '${name}' is not valid`, callbackList !== undefined);\n\n    return callbackList;\n  }\n\n  on(name: keyof Callbacks, callback: Fn) {\n    const callbackList = this.#getCallbackList(name);\n\n    callbackList.add(callback);\n  }\n\n  off(name: keyof Callbacks, callback: Fn) {\n    const callbackList = this.#getCallbackList(name);\n\n    callbackList.delete(callback);\n  }\n\n  trigger(name: keyof Callbacks) {\n    const callbackList = this.#getCallbackList(name);\n    for (const callback of callbackList) {\n      try {\n        callback();\n      } catch {\n        // Ignore\n      }\n    }\n  }\n\n  match(name: string, query: string) {\n    if (isTesting) {\n      return;\n    }\n\n    const mediaQueryList = matchMedia(query);\n\n    const listener = (matcher: Matcher) => {\n      let changed = false;\n\n      if (matcher.matches) {\n        if (!this.matches.has(name)) {\n          this.matches.add(name);\n          changed = true;\n        }\n      } else {\n        changed = this.matches.has(name);\n        this.matches.delete(name);\n      }\n\n      if (changed) {\n        runTask(this, () => this.trigger('mediaChanged'));\n      }\n    };\n\n    mediaQueryList.addEventListener('change', (event) => {\n      runTask(this, () => listener(event));\n    });\n\n    listener(mediaQueryList);\n  }\n}\n\ndeclare module '@ember/service' {\n  interface Registry {\n    media: MediaService;\n  }\n}\n"],"names":["isTesting","macroCondition","isTestingMacro","defaultBreakpoints","Object","freeze","xsmall","small","medium","large","xlarge","xxlarge","MediaService","Service","_mockedBreakpoint","g","prototype","tracked","TrackedSet","i","callbacks","mediaChanged","Set","breakpoints","getOwnConfig","constructor","owner","name","query","entries","match","matches","mocked","_matches","value","isXSmall","has","isSmall","isMedium","isLarge","isXLarge","isXXLarge","#getCallbackList","callbackList","assert","undefined","on","callback","add","off","delete","trigger","mediaQueryList","matchMedia","listener","matcher","changed","runTask","addEventListener","event"],"mappings":"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"}